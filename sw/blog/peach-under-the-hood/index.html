<!DOCTYPE html><html lang="sw"><head><meta charset="UTF-8"/><meta http-equiv="X-UA-Compatible" content="ie=edge"/><meta http-equiv="X-Frame-Options" content="DENY"/><meta http-equiv="X-XSS-Protection" content="1; mode=block"/><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/><meta name="keywords" content="[&quot;Bidhaa&quot;,&quot;P2P&quot;,&quot;mwongozo&quot;,&quot;programu&quot;,&quot;javascript&quot;,&quot;bitcoin&quot;]"/><meta name="description" content="Aaaaah Bitcoin — aina hii nzuri ya pesa inayofanikiwa kutokana na vipengele vyake vya msingi.  
Sote tunapenda, lakini tunatambua pia kwamba kuna hatari zinazohusiana na uhuru wa binafsi: ukishiriki seed zako, unaweza kupoteza kila kitu.  
Ukituma kwa anwani isiyo sahihi, hutapata tena."/><meta property="og:locale" content="sw"/><meta property="og:site_name"/><meta property="og:title" content="Peach Bitcoin Exchange - Buy and Sell Bitcoin Anonymously and Without KYC"/><meta property="og:description" content="Peach Bitcoin - Buy Bitcoin with gift card, no verification. Exchange peer to peer for anonymous transactions. Learn how to buy and sell Bitcoin privately and without KYC. Manage your Bitcoin securely with our non-KYC platform."/><meta property="og:type" content="website"/><meta property="og:image" content="/img/blog/under-the-hood/peachmechanic2.png"/><meta property="og:image:secure_url" content="/img/blog/under-the-hood/peachmechanic2.png"/><meta property="og:image:width" content="1296"/><meta property="og:image:height" content="678"/><meta name="twitter:site" content="@peachbitcoin"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Peach Bitcoin Chini ya Hoods: mtazamo wa kiufundi kwa nini ni ubadilishaji wa P2P salama zaidi · Peach Bitcoin"/><meta name="twitter:description" content="Peach Bitcoin - Buy Bitcoin with gift card, no verification. Exchange peer to peer for anonymous transactions. Learn how to buy and sell Bitcoin privately and  without KYC. Manage your Bitcoin securely with our non-KYC platform."/><meta name="twitter:image" content="/img/blog/under-the-hood/peachmechanic2.png"/><meta name="msapplication-TileColor" content="#F56522"/><meta name="theme-color" content="#F56522"/><link rel="preload" as="font" crossorigin="crossorigin" href="/fonts/baloo-2-v16-latin-regular.woff2"/><link rel="preload" as="font" crossorigin="crossorigin" href="/fonts/baloo-2-v16-latin-600.woff2"/><link rel="preload" as="font" crossorigin="crossorigin" href="/fonts/baloo-2-v16-latin-800.woff2"/><link rel="apple-touch-icon" href="/img/favicon/apple-touch-icon.png"/><link rel="icon" href="/img/favicon/favicon.svg"/><link rel="manifest" href="/site.webmanifest"/><link rel="mask-icon" href="/img/favicon/safari-pinned-tab.svg" color="#F56522"/><link rel="stylesheet" href="/css/main-8c7d0a0965d37fafcf6e9215d363177f.css"/><title>Peach Bitcoin Chini ya Hoods: mtazamo wa kiufundi kwa nini ni ubadilishaji wa P2P salama zaidi · Peach Bitcoin</title><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KQHJRQKH');</script></head><body id="blog-peach-under-the-hood"><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KQHJRQKH" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><header class="header header-container" id="header"><div class="wrap"><a class="logo-link brand" href="/sw/"><img class="logo logo" src="/img/peach-bitcoin-145cd6c0079ccacc9c70c892060964d1.svg" alt="Peach Bitcoin"/></a><input id="show-menu" type="checkbox"/><label class="nav-toggle-label" id="nav-toggle" for="show-menu"><svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path class="line--1" d="M0 70l28-28c2-2 2-2 7-2h64"></path><path class="line--2" d="M0 50h99"></path><path class="line--3" d="M0 30l28 28c2 2 2 2 7 2h64"></path></svg></label><nav class="nav"><a href="/sw/how-it-works/">Köp BTC utan KYC</a><a href="/sw/for-meetups/">Köp BTC med kontanter</a><a href="/sw/for-businesses/">Sälj BTC</a><a href="/sw/blog/">Blogg</a><a href="/sw/support/">Support</a><div class="language-selector"><input class="checkbox" type="checkbox" id="language-toggle"/><label class="language-label" for="language-toggle"><img class="flag-icon" src="/img/en-872bf10f0d1ed191b502494534bb329a.png" alt="UK Flag"/><img src="/img/dropdown_icon-fcd9aa7055472ef4a4e83b593450c048.svg" style="width: 1rem;" alt="Dropdown icon"/></label><ul class="language-dropdown"><li><a href="/"><img class="flag-icon" src="/img/en-872bf10f0d1ed191b502494534bb329a.png" alt="EN Flag"/><span>English</span></a></li><li><a href="/es"><img class="flag-icon" src="/img/es-b17fc8846b93c5446b10cd7824434504.png" alt="ES Flag"/><span>Español</span></a></li><li><a href="/de"><img class="flag-icon" src="/img/de-0da84d0f3850d6e25088debeb3ade32c.png" alt="DE Flag"/><span>Deutsch</span></a></li><li><a href="/it"><img class="flag-icon" src="/img/it-299996a0097e49e1bc4f312e380d3faa.png" alt="IT Flag"/><span>Italiano</span></a></li><li><a href="/fr"><img class="flag-icon" src="/img/fr-75a63faa5728ac4175214da6cd3c47f1.png" alt="FR Flag"/><span>Français</span></a></li><li><a href="/el"><img class="flag-icon" src="/img/el-27d234921e954ed945c93bef880a07b6.png" alt="GR Flag"/><span>Ελληνικά</span></a></li><li><a href="/hu"><img class="flag-icon" src="/img/hu-fc4c517f481932d60d59b56a8f0c322d.png" alt="HU Flag"/><span>Magyar</span></a></li><li><a href="/nl"><img class="flag-icon" src="/img/nl-83a65573b2d26cdce16cab98f8c38db1.png" alt="NL Flag"/><span>Nederlands</span></a></li><li><a href="/pl"><img class="flag-icon" src="/img/pl-f7c03eb5351f5b2e33c9b29f1e200e38.png" alt="PL Flag"/><span>Polski</span></a></li><li><a href="/pt"><img class="flag-icon" src="/img/pt-997fb3879120a45e1ba507a9e060a662.png" alt="PT Flag"/><span>Português</span></a></li><li><a href="/sw"><img class="flag-icon" src="/img/sw-cdf6e2b06778f5ac662fb25f3ca8eac0.png" alt="SW Flag"/><span>Kiswahili</span></a></li><li><a href="/uk"><img class="flag-icon" src="/img/ua-f7a81ef67d0931a29f7e358bb99ef521.png" alt="UA Flag"/><span>Українська</span></a></li></ul></div></nav></div></header><main class="main" id="main"><div id="header-anchor"></div><section class="wrap"><div class="content-wrap post"><h1 id="peach-bitcoin-chini-ya-hoods-mtazamo-wa-kiufundi-kwa-nini-ni-ubadilishaji-wa-p2p-salama-zaidi">Peach Bitcoin Chini ya Hoods: mtazamo wa kiufundi kwa nini ni ubadilishaji wa P2P salama zaidi</h1>
<div class="video-wrapper">
  <iframe
    src="https://www.youtube.com/embed/UvdbHlsPmK0"
    title="PEACH VIDEO OF Under the Hood"
    frameborder="0"
    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
    referrerpolicy="strict-origin-when-cross-origin"
    allowfullscreen
  ></iframe>
</div>
<p>Aaaaah Bitcoin — aina hii nzuri ya pesa inayofanikiwa kutokana na vipengele vyake vya msingi.<br>
Sote tunapenda, lakini tunatambua pia kwamba kuna hatari zinazohusiana na uhuru wa binafsi: ukishiriki seed zako, unaweza kupoteza kila kitu.<br>
Ukituma kwa anwani isiyo sahihi, hutapata tena.</p>
<p>Hivyo basi, kutoa programu zinazohusiana na Bitcoin kama open-source ni muhimu sana — App ya Peach inapatikana kwenye GitHub kwa kila mtu ambaye anataka kuangalia!</p>
<p>Kwa hakika, kuwa open-source haimaanishi kila mtu atasoma kwa makini na kuelewa kanuni na mbinu.<br>
Ndiyo maana ninaandika makala hii: ili <strong>kuonyesha jinsi Peach ilivyo salama</strong> na hatua zilizofanywa kufanikisha hilo.</p>
<h2 id="hatua-1-kutengeneza-akaunti-isiyo-na-kyc-kwenye-peach">Hatua 1: Kutengeneza Akaunti Isiyo na KYC kwenye Peach</h2>
<p>Ili kuwa wazi kabisa: Seed yako ya Bitcoin <strong>ndiyo Akaunti yako ya Peach</strong>.</p>
<p>Ili kutumia Peach, unahitaji kutengeneza akaunti, ambayo inahusisha kushiriki Public Key ya akaunti yako na kuthibitisha umiliki wako.</p>
<p>Ili kufanya hivyo:</p>
<ul>
<li>1 - pata Tarehe na Muda wa sasa (kwa millisekunde) kama maandishi</li>
<li>2 - tumia Private Key yako kuunda saini ya maandishi hayo</li>
<li>3 - tuma Public Key, tarehe/muda wa sasa na saini</li>
</ul>
<p>Pia unahitaji kuunda <code>uniqueId</code> itakayosaidia kuzuia watumiaji wengine kujifanya wewe.<br>
Hii ni muhimu kwa mfano ikiwa unapoteza seed zako lakini unataka kudumisha akaunti hiyo hiyo.<br>
Lakini tusiingilie undani sana hapa.</p>
<p><br><br>
<img src="/img/blog/under-the-hood/underthehood01.png" alt="this is the power of p2p exchanger" style="display:block; margin: auto; width: 70%;">
<br><br></p>
<p>Hapa kuna nambari ya JavaScript kufanya hili:</p>
<pre><code class="language-j">
  const seed = randomBytes(64);

  const root = bip32.fromSeed(seed, bitcoin);
  const child = root.derivePath(&quot;m/0&quot;);
  const keyPair = ECPair.fromPrivateKey(child.privateKey, { network: bitcoin });

  const publicKeyHex = Buffer.from(keyPair.publicKey).toString(&quot;hex&quot;);

  const session = axios.create({
    baseURL: &quot;https://api.peachbitcoin.com/&quot;,
    httpAgent: new http.Agent({ keepAlive: false }),
    httpsAgent: new https.Agent({ keepAlive: false }),
  });

  const registerMessage = String(Date.now());
  const registerMessageSignature = signWithBtcPrivKey(registerMessage, keyPair);

  const resp = await session.post(&quot;v1/user/register&quot;, {
    publicKey: publicKeyHex,
    message: registerMessage,
    signature: registerMessageSignature,
    uniqueId: &quot;my_own_unique_id_random_12345&quot;,
  });

  const accessToken = resp.data.accessToken;

  session.defaults.headers.common[&quot;authorization&quot;] = accessToken;

</code></pre>
<p>Hongera! Umeunda akaunti kwenye Peach!<br>
Server imehakiki kwamba kwa wakati huu wewe ndiye mmiliki wa Bitcoin Key-Pair inayolingana na Public Key uliyoituma.</p>
<h2 id="hatua-2-kutuma-public-pgp-key-yako">Hatua 2: Kutuma Public PGP Key yako</h2>
<p>Kutakuwa na usimbaji wa data mwingi… na pia ufunguaji wa data.<br>
Bitcoin Keys zinaweza tu kusimba kwa njia moja, kwa hivyo tunahitaji PGP Keys kwa usimbaji wa njia mbili.<br>
Hii ni muhimu kwa usimbaji na ufunguaji wa data za akaunti za benki, ujumbe wa chat, n.k.</p>
<p>Kutuma Public PGP Key ni sawa na kutuma Public Bitcoin Key, lakini kuna hatua ya ziada:<br>
kusaini Public PGP Key kwa Bitcoin Private Key, ili kuthibitisha kuwa mtumiaji ndiye mmiliki wa Bitcoin na PGP Keys zote.</p>
<p><br><br>
<img src="/img/blog/under-the-hood/underthehood02.png" alt="this is the power of p2p exchanger" style="display:block; margin: auto; width: 70%;">
<br><br></p>
<pre><code class="language-j">
const { privateKey: pgpPrivateKey, publicKey: pgpPublicKey } =
    await createPGPKey();

  const pgpPublicKeyMessageSignature = signWithBtcPrivKey(
    pgpPublicKey,
    keyPair
  );
  const setPgpKeysMessage = String(Date.now());

  const setPgpKeysMessageSignature = await signPGPMessage(
    pgpPrivateKey,
    setPgpKeysMessage
  );

  await session.patch(&quot;v1/user&quot;, {
    pgpPublicKey: pgpPublicKey, // the PGP Pub key
    signature: pgpPublicKeyMessageSignature, // the above signed by the BTC Key
    message: setPgpKeysMessage, // the current timestamp
    pgpSignature: setPgpKeysMessageSignature, // the above signed by the PGP Key
  });

</code></pre>
<p>Kwa wakati huu, Peach ina Public Keys zote zako za Bitcoin na PGP!<br>
Hii itakuwa muhimu sana kwa biashara kwenye Peach.</p>
<h2 id="hatua-zifuatazo">Hatua Zifuatazo</h2>
<p>Kuanzia sasa, mwongozo utaonyesha pande zote mbili: upande wa Mnunuzi na upande wa Muuzaji.</p>
<p>Hatua ni:</p>
<ul>
<li>3.S Muuzaji anaunda Ofa ya Uuzaji</li>
<li>4.S Muuzaji anatoza Peach Escrow</li>
<li>5.B Mnunuzi anatoa Trade Request kwenye Ofa ya Uuzaji</li>
<li>5.S Muuzaji anakubali Trade Request ya Mnunuzi</li>
<li>6.B Mnunuzi anatangaza kuwa Malipo ya Fiat yamefanywa</li>
<li>6.S Muuzaji anathibitisha kupokea Malipo</li>
</ul>
<h2 id="hatua-3s-muuzaji-anaunda-ofa-ya-uuzaji">Hatua 3.S: Muuzaji anaunda Ofa ya Uuzaji</h2>
<p>Kuunda Ofa ya Uuzaji ni sawa na kutangaza kuwa uko tayari kuuza kiasi fulani cha Bitcoin.<br>
Lakini si hivyo tu: Muuzaji lazima akubali kitu kwa malipo.</p>
<p>Tofauti ya Ofa ya Uuzaji:</p>
<ul>
<li>kiasi cha Bitcoin cha kuuza</li>
<li>Sarafu zinazokubalika na Muuzaji</li>
<li>Mbinu za Malipo zinazokubalika na Muuzaji (pesa taslimu, Uhamisho wa Benki, Revolut, nk.)</li>
<li>Premium (bei ya juu ya Bitcoin kulingana na thamani ya soko)</li>
</ul>
<p>Iwapo kila kitu kitakwenda vizuri, Mnunuzi atavutiwa na ofa na kutoa Trade Request.<br>
Wakati huo, lazima achague <strong>sarafu moja na njia ya malipo moja</strong>.<br>
Kadri Muuzaji anavyoonyesha chaguzi nyingi, ndivyo uwezekano wa kuvutia Mnunuzi unavyoongezeka.</p>
<p><br><br>
<img src="/img/blog/under-the-hood/underthehood03.png" alt="this is the power of p2p exchanger" style="display:block; margin: auto; width: 40%;">
<br><br></p>
<pre><code class="language-j">
const sats_to_sell = 21000;
  const sell_premium = 1; // 1%
  const payment_data_currency = &quot;EUR&quot;;
  const payment_data_method = &quot;wise&quot;;

  const { address: returnAddress } = bitcoin.payments.p2wpkh({
    pubkey: Buffer.from(keyPair.publicKey),
    network: bitcoin,
  });
  const sellOfferPaymentDataToEncrypt = JSON.stringify({
    reference: &quot;&quot;,
    userName: &quot;@myWiseIdTradingBot&quot;,
  });

  const paymentDataEncryptSHA256 = await sha256(sellOfferPaymentDataToEncrypt);

  const offerCreateRes = await session.post(&quot;v1/offer&quot;, {
    type: &quot;ask&quot;,
    amount: sats_to_sell,
    meansOfPayment: { [payment_data_currency]: [payment_data_method] }, // {&quot;EUR&quot;: [&quot;wise&quot;]}
    paymentData: {
      [payment_data_method]: { hashes: [paymentDataEncryptSHA256] },
    },
    returnAddress: returnAddress,
    premium: sell_premium,
  });

</code></pre>
<p>Kwenye nambari, Muuzaji anatangaza kuuza 21,000 Sats (0.00021 Bitcoin) kwa premium ya 1%.<br>
Anataka kupokea Euro kupitia akaunti yake ya Wise.<br>
Haitoi ID ya akaunti yake ya Wise, bali hash tu.<br>
Peach haitajua maelezo ya Malipo yake, ili kudumisha usiri.<br>
Pia, anatoa <strong>Anwani ya Kurudisha</strong> kwa kesi ya kurudishiwa fedha.</p>
<h2 id="hatua-4s-muuzaji-anatoza-peach-escrow">Hatua 4.S: Muuzaji anatoza Peach Escrow</h2>
<p>Baada ya ombi la API la Peach kuunda Ofa ya Uuzaji, Muuzaji anapata ID ya Ofa:</p>
<pre><code class="language-j">const sellOfferId = offerCreateRes.data.id;

</code></pre>
<p>Hifadhi thamani hii.<br>
Oferta imetengenezwa, lakini bado si ya umma: hakuna Mnunuzi anayeweza kuingiliana nayo.<br>
Kwanza, Muuzaji lazima atoze Escrow.</p>
<p>Escrow ni kama Hazina inayohitaji idhini ya Muuzaji na Peach.<br>
Bitcoin inaingizwa kwenye Hazina na inabaki salama hadi mwisho wa Biashara.<br>
Kwa kuwa inahitaji idhini ya Muuzaji, na Escrow ni Script kwenye Bitcoin Blockchain (anwani ya P2WSH), Peach inahitaji Public Key ya Muuzaji kuunda Escrow hii.</p>
<p>Kwa wakati huu, Muuzaji anatoa Public Key anayotaka kutumia kwa Escrow.<br>
Peach huchagua Public Key yake yenyewe na kuunda anwani.</p>
<p><br><br>
<img src="/img/blog/under-the-hood/underthehood04.png" alt="this is the power of p2p exchanger" style="display:block; margin: auto; width: 40%;">
<br><br></p>
<pre><code class="language-j">const childSell = root.derivePath(`m/84'/0'/0'/${sellOfferId}'`);

  const keyPairSellOffer = ECPair.fromPrivateKey(childSell.privateKey, {
    network: bitcoin,
  });

  const sellOfferPublicKey = Buffer.from(keyPairSellOffer.publicKey).toString(
    &quot;hex&quot;
  );

  const escrowCreateRes = await session.post(
    &quot;v1/offer/&quot; + sellOfferId + &quot;/escrow&quot;,
    {
      publicKey: sellOfferPublicKey,
    }
  );

  const escrowAddress = escrowCreateRes.data.escrows.bitcoin;

  const escrowPeachPublicKey =
    escrowCreateRes.data.escrowPeachPublicKey.bitcoin;

</code></pre>
<p>Kwenye nambari, Muuzaji anatoa Key Pair mpya kwa kutumia ID ya Ofa ya Uuzaji.<br>
Hii ni njia salama na inayoweza kurudiwa.</p>
<p>Baada ya kutuma Public Key, API ya Peach inarudisha anwani ambapo Muuzaji anatakiwa kutuma 21,000 Sats.<br>
Lakini huna haja ya kuamini tu: unaweza kuthibitisha.</p>
<p>Tuthibitishe!</p>
<p>API ya Peach pia inarudisha Public Key iliyotumika kwa Escrow hii, ambayo inaturuhusu kuunda anwani tena kwa kutumia Bitcoin Script.</p>
<pre><code class="language-j">   OP_IF
       ${script.number.encode(4320).toString(&quot;hex&quot;)}
       OP_CHECKSEQUENCEVERIFY
       OP_DROP
   OP_ELSE
       ${sellerPublicKey}
       OP_CHECKSIGVERIFY
   OP_ENDIF
   ${peachPublicKey}
   OP_CHECKSIG
</code></pre>
<p>Script ya Escrow:</p>
<ul>
<li>inahitaji saini ya Peach kila wakati</li>
<li>na zaidi:
<ul>
<li>inahitaji saini ya Muuzaji</li>
<li>au kwamba block 4320 zimechimbwa tangu Bitcoin itumwe kwenye anwani hiyo</li>
</ul>
</li>
</ul>
<p>Kwa nini 4320 block?<br>
Hiyo ni takriban siku 30 za block (1 block kila dakika 10 kwa wastani).<br>
Baada ya mwezi, Peach inaweza kutoa saini peke yake ikiwa Muuzaji hatashirikiana au atapoteza key zake.</p>
<p>Peach ina sifa safi ya kushughulikia fedha za Muuzaji.</p>
<p>Baada ya kujenga script, unaweza kuthibitisha anwani ya P2WSH inayoundwa na kuona kuwa ni ile ile API ya Peach iliyorudisha.</p>
<pre><code class="language-j">  const multisigScript = bitcoin.script.compile([
    Buffer.from(sellOfferPublicKey, &quot;hex&quot;),
    bitcoin.opcodes.OP_CHECKSIGVERIFY,
  ]);

  const timelockScript = bitcoin.script.compile([
    bitcoin.script.number.encode(4320),
    bitcoin.opcodes.OP_CHECKSEQUENCEVERIFY,
    bitcoin.opcodes.OP_DROP,
  ]);

  const redeemScript = bitcoin.script.compile([
    bitcoin.opcodes.OP_IF,
    ...timelockScript,
    bitcoin.opcodes.OP_ELSE,
    ...multisigScript,
    bitcoin.opcodes.OP_ENDIF,
    Buffer.from(escrowPeachPublicKey, &quot;hex&quot;),
    bitcoin.opcodes.OP_CHECKSIG,
  ]);

  const escrowPayment = bitcoin.payments.p2wsh({
    redeem: { output: redeemScript },
    network: bitcoin,
  });

  console.log(&quot;Addresses Match:&quot;, escrowPayment.address === escrowAddress);

</code></pre>
<p>Nzuri! Sasa fanya muamala wa Bitcoin kwa anwani hiyo na subiri Escrow itajulikana kama imefadhiliwa.</p>
<pre><code class="language-j">  while (true) {
    const fundingStatusRes = await session.get(
      &quot;v1/offer/&quot; + sellOfferId + &quot;/escrow&quot;
    );
    if (fundingStatusRes.data.funding.status === &quot;FUNDED&quot;) {
      break;
    }
  }

</code></pre>
<p>Baada ya block moja, Ofa ya Uuzaji inakuwa ya umma na Wanunuzi wanaweza kuanza kuingiliana nayo.</p>
<h2 id="hatua-5b-mnunuzi-anatoa-trade-request-kwenye-ofa-ya-uuzaji">Hatua 5.B: Mnunuzi anatoa Trade Request kwenye Ofa ya Uuzaji</h2>
<p>Sasa ni wakati wa Mnunuzi kuchukua hatua!</p>
<p>Kwanza, angalia Ofa zote za Uuzaji zilizopo:</p>
<pre><code class="language-j">const sellOffers = await session.get(&quot;v069/sellOffer&quot;);
</code></pre>
<p>Kwa urahisi, Mnunuzi atavutiwa na Ofa ya kwanza iliyopo.</p>
<pre><code class="language-j">const sellOfferToTradeRequestId = sellOffers.data.offers[0].id;
</code></pre>
<p>Mnunuzi anataka kutoa Trade Request, kumjulisha Muuzaji kuwa yuko tayari kufanya Biashara chini ya masharti yake.<br>
Inaonekana rahisi, lakini hili ndilo hatua <strong>ngumu zaidi</strong> ya mchakato mzima.</p>
<p>Mnunuzi lazima atume:</p>
<ul>
<li>Njia ya Malipo inayopendekezwa (moja kati ya zile zinazokubaliwa na Muuzaji)</li>
<li>Sarafu inayopendekezwa (kama ilivyotajwa hapo juu)</li>
<li>Key Simetrici (kwa mawasiliano ya moja kwa moja kati ya Mnunuzi na Muuzaji) iliyosimbwa</li>
<li>Saini ya Key Simetrici</li>
<li>Data za Malipo zilizofichwa kwa kutumia Key Simetrici</li>
<li>Saini ya Data za Malipo</li>
<li>Anwani ya Kutoa (Release Address): ambapo Mnunuzi anataka kupokea Bitcoin iliyonunuliwa</li>
<li>Saini ya Ujumlishaji wa Anwani ya Kutoa: uthibitisho kwamba Mnunuzi ndiye mmiliki, ukitumia BIP-322</li>
<li>Ada ya juu ya kuchimba: kiasi gani Mnunuzi yuko tayari kutoa kwa malipo ya Miners</li>
</ul>
<p>Ni mengi, sivyo?<br>
Lakini ndiyo maana Peach ni salama sana!<br>
Tufanye hatua kwa hatua.</p>
<h3 id="njia-ya-malipo-na-sarafu-inayopendekezwa">Njia ya Malipo na Sarafu inayopendekezwa</h3>
<p>Hii ni rahisi zaidi:</p>
<pre><code class="language-j">  const payment_data_currency = &quot;EUR&quot;;
  const payment_data_method = &quot;wise&quot;;

</code></pre>
<h3 id="key-simetrici">Key Simetrici</h3>
<p>Key Simetrici itatumika na <strong>AES256 Usimbaji wa Mbili-Njia</strong>: unaweza kusimba ujumbe na kisha kuufungua kwa kutumia key ile ile.</p>
<pre><code class="language-j">async function decryptDataWithSymmetricKey(encryptedMessage, symmetricKey) {
  const message = await openpgp.readMessage({
    armoredMessage: encryptedMessage,
  });

  const { data: decrypted } = await openpgp.decrypt({
    message,
    passwords: [symmetricKey],
    format: &quot;utf8&quot;,
  });

  return decrypted;
}

async function encryptDataWithSymmetricKey(data, symmetricKey) {
  const message = await openpgp.createMessage({ text: data });
  const encrypted = await openpgp.encrypt({
    message,
    passwords: [symmetricKey],
    format: &quot;armored&quot;,
    config: {
      preferredSymmetricAlgorithm: openpgp.enums.symmetric.aes256,
    },
  });
  return encrypted;
}

</code></pre>
<p>Tengeneza namba nasibu:</p>
<pre><code class="language-j">  const symmetricKey = randomBytes(32);
  const symmetricKeyHex = symmetricKey.toString(&quot;hex&quot;);

</code></pre>
<p>Hautatumia key hii waziwazi!<br>
Lazima isimbwe kwa njia ambayo Mnunuzi na Muuzaji pekee wanaweza kuufungua, kwa kutumia Public PGP Keys zao.</p>
<pre><code class="language-j">async function encryptForMultipleRecipients(secret, publicKeysArmored) {
  const publicKeys = await Promise.all(
    publicKeysArmored.map((armored) =&gt; openpgp.readKey({ armoredKey: armored }))
  );
  const message = await openpgp.createMessage({ text: secret });

  const encrypted = await openpgp.encrypt({
    message,
    encryptionKeys: publicKeys,
  });

  return encrypted;
}

  const matchingUserPgpPubKey = sellOffers.data.offers[0].user.pgpPublicKey;

  const symmetricKeyEncrypted = await encryptForMultipleRecipients(
    symmetricKeyHex,
    [pgpPublicKey, matchingUserPgpPubKey]
  );

</code></pre>
<p>Ili Muuzaji ajue kuwa Key Simetrici imetengenezwa na Mnunuzi, lazima pia aisaini:</p>
<pre><code class="language-j">  const symmetricKeySignature = await signPGPMessage(
    pgpPrivateKey,
    symmetricKeyHex
  );

</code></pre>
<h3 id="data-za-malipo">Data za Malipo</h3>
<p>Hizi ndizo taarifa muhimu zaidi: IBAN, username ya Revolut, kila kitu kinachotambua chanzo cha malipo ya Fiat.<br>
Mnunuzi anazisimba na Key Simetrici ili Muuzaji aweze kuzipata baadaye.</p>
<pre><code class="language-j">const paymentDataToEncrypt = JSON.stringify({
    reference: &quot;&quot;,
    userName: &quot;@buyerWiseId&quot;,
  });

const paymentDataEncrypted = await encryptDataWithSymmetricKey(
paymentDataToEncrypt,
symmetricKeyHex
);

const paymentDataSignature = await signPGPMessage(
pgpPrivateKey,
paymentDataToEncrypt
);

</code></pre>
<h3 id="kuweka-anwani-ya-kutoa-na-kuthibitisha-umiliki">Kuweka Anwani ya Kutoa na kuthibitisha umiliki</h3>
<p>Lazima uamue wapi Bitcoin ya Biashara itatumwa.<br>
Kuunda anwani ni rahisi; kuthibitisha umiliki ni changamoto.<br>
Hufanywa kwa sababu za kisheria na kama tahadhari ya ziada.<br>
Tuna tumia <strong>BIP-322</strong>: saini ujumbe kwa Private Key yako ya Bitcoin, uthibitishwe kwa Anwani.</p>
<pre><code class="language-j">  const { address } = bitcoin.payments.p2wpkh({
    pubkey: Buffer.from(keyPair.publicKey),
    network: bitcoin,
  });

  const ownershipMessage =
    &quot;I confirm that only I, peach&quot; +
    publicKeyHex.slice(0, 8) +
    &quot;, control the address &quot; +
    address;

  const releaseAddressSignature = signWithBIP322(
    wif,
    address,
    ownershipMessage
  );

</code></pre>
<h3 id="ada-ya-juu-ya-kuchimba">Ada ya juu ya kuchimba</h3>
<p>Mnunuzi anaweza kuamua kiasi cha juu kinachokubalika cha ada ya miners kwa muamala.</p>
<h3 id="kutoa-trade-request">Kutoa Trade Request</h3>
<p>Sasa kila kitu kimeandaliwa, na Mnunuzi anatuma Trade Request.</p>
<pre><code class="language-j">  await session.post(
    &quot;v069/sellOffer/&quot; + sellOfferToTradeRequestId + &quot;/tradeRequestPerformed&quot;,
    {
      paymentMethod: payment_data_method,
      currency: payment_data_currency,
      paymentDataHashed: paymentDataToEncryptSHA256,
      paymentDataEncrypted: paymentDataEncrypted,
      paymentDataSignature: paymentDataSignature,
      symmetricKeyEncrypted: symmetricKeyEncrypted,
      symmetricKeySignature: symmetricKeySignature,
      maxMiningFeeRate: 2, // sats/vb
      releaseAddress: address,
      releaseAddressMessageSignature: releaseAddressSignature,
    }
  );

</code></pre>
<p><br><br>
<img src="/img/blog/under-the-hood/underthehood05.png" alt="this is the power of p2p exchanger" style="display:block; margin: auto; width: 40%;">
<br><br></p>
<p>Sasa ni zamu ya Muuzaji kukubali.</p>
<h2 id="hatua-5s-muuzaji-anakubali-trade-request">Hatua 5.S: Muuzaji anakubali Trade Request</h2>
<p>Muuzaji anakagua orodha ya Trade Requests zilizopokelewa:</p>
<pre><code class="language-j">const receivedTradeRequestRequest = await session.get(
    &quot;v069/sellOffer/&quot; + sellOfferId + &quot;/tradeRequestReceived&quot;
  );

  const tradeReq = receivedTradeRequestRequest.data[0];

</code></pre>
<p>Kama Muuzaji anakubali Trade Request, lazima ashiriki Data zake za Malipo na Mnunuzi, ili Mnunuzi ajue wapi Fiat itatumwa.</p>
<p>Kwa kuwa Key Simetrici tayari imetumwa na Mnunuzi, Muuzaji anaweza kuifungua na kuitumia kusimba Data zake za Malipo.</p>
<pre><code class="language-j">  const receivedSymmetricKey = await decryptWithPrivateKey(
    tradeReq.symmetricKeyEncrypted,
    pgpPrivateKey
  );

  const sellOfferPaymentDataEncrypted = await encryptDataWithSymmetricKey(
    sellOfferPaymentDataToEncrypt,
    receivedSymmetricKey
  );

  const sellOfferPaymentDataSignature = await signPGPMessage(
    pgpPrivateKey,
    sellOfferPaymentDataToEncrypt
  );

</code></pre>
<p>Na hiyo ni yote! Sasa Muuzaji anaweza kukubali Trade Request na Biashara rasmi inaanza.</p>
<p><br><br>
<img src="/img/blog/under-the-hood/underthehood06.png" alt="this is the power of p2p exchanger" style="display:block; margin: auto; width: 40%;">
<br><br></p>
<pre><code class="language-j">  await session.post(
    &quot;v069/sellOffer/&quot; +
      sellOfferId +
      &quot;/tradeRequestReceived/&quot; +
      tradeReq.userId +
      &quot;/accept&quot;,
    {
      paymentDataEncrypted: sellOfferPaymentDataEncrypted,
      paymentDataSignature: sellOfferPaymentDataSignature,
      paymentData: {
        [payment_data_method]: { hashes: [paymentDataEncryptSHA256] },
      },
    }
  );

</code></pre>
<p>Ikiwa kuelewa mchakato mzima ni mgumu, hapa kuna picha ya kuelezea:</p>
<p><br><br>
<img src="/img/blog/under-the-hood/underthehood07.png" alt="this is the power of p2p exchanger" style="display:block; margin: auto; width: 90%;">
<br><br></p>
<h2 id="hatua-6b-mnunuzi-anatangaza-malipo-yametolewa">Hatua 6.B: Mnunuzi anatangaza Malipo yametolewa</h2>
<p>Mnunuzi anaweza kuangalia kama ana Mikataba (Trades zilizokubaliwa na Muuzaji) kwa kutumia endpoint ya <code>contract summaries</code>:</p>
<pre><code class="language-j">  const contractsRes = await session.get(&quot;v1/contracts/summary&quot;);
  const contract = contractsRes.data.find((obj) =&gt;
    obj.id.startsWith(sellOfferToTradeRequestId + &quot;-&quot;)
  );

  if (contract.tradeStatus !== &quot;paymentRequired&quot;) throw Error;
</code></pre>
<p>Kama Mkataba una hali ya <strong>“paymentRequired”</strong>, basi ni zamu ya Mnunuzi kufanya malipo ya Fiat.</p>
<p>Ili kufanya hivyo, afungua Data za Malipo za Muuzaji kwa Key Simetrici ya wakati Trade Request ilitolewa.<br>
Kama hakuwa ameihifadhi, anaweza kutumia Private PGP Key yake.</p>
<pre><code class="language-j">
  const contractRes = await session.get(&quot;v1/contract/&quot; + contract.id);

  const receivedSymmetricKey = await decryptWithPrivateKey(
    contractRes.data.symmetricKeyEncrypted,
    pgpPrivateKey
  );

  if (receivedSymmetricKey !== symmetricKeyHex) throw Error;

  const decryptedSellerPaymentData = await decryptDataWithSymmetricKey(
    contractRes.data.paymentDataEncrypted,
    receivedSymmetricKey
  );

  console.log(&quot;Seller Payment Data &quot;, JSON.parse(decryptedSellerPaymentData));
</code></pre>
<p>Hii inapaswa kufanywa nje ya Peach: Mnunuzi anafungua App ya Benki na kufanya Uhamisho wa Fiat.</p>
<p>Bitcoin tayari ipo kwenye Escrow, inasimamiwa na Peach na Muuzaji.<br>
Unaweza pia kuangalia Anwani ya Escrow kwenye data za Mkataba na kutumia Blockchain Explorer.</p>
<p>Baada ya malipo kufanywa, Mnunuzi anatangaza kuwa Malipo yametolewa:</p>
<pre><code class="language-j">  const confirmPaymentRes = await session.post(
    &quot;v1/contract/&quot; + contract.id + &quot;/payment/confirm&quot;
  );
</code></pre>
<p><br><br>
<img src="/img/blog/under-the-hood/underthehood08.png" alt="this is the power of p2p exchanger" style="display:block; margin: auto; width: 40%;">
<br><br></p>
<p>Hii ilikuwa Hatua ya mwisho ya Mnunuzi.<br>
Sasa Muuzaji lazima athibitishe kupokea Fiat na kutoa Bitcoin kwenye Anwani ya Mnunuzi.</p>
<h2 id="hatua-6s-muuzaji-anathibitisha-kupokea-malipo">Hatua 6.S: Muuzaji anathibitisha kupokea Malipo</h2>
<p>Vivyo hivyo, Muuzaji anakagua Mikataba iliyopangiwa kwake.</p>
<pre><code class="language-j">  const contractsRes = await session.get(&quot;v1/contracts/summary&quot;);
  const contract = contractsRes.data[0];

  const contractRes = await session.get(&quot;v1/contract/&quot; + contract.id);

</code></pre>
<p>Majibu ya API yanajumuisha <strong>PSBT</strong> (Partially Signed Bitcoin Transaction)<br>
ambayo ni muamala wa Bitcoin kutoka Escrow hadi Anwani ya Mnunuzi.<br>
Saini ya Peach tayari ipo, inahitaji saini ya Muuzaji tu.</p>
<pre><code class="language-j">  const releasePSBTBase64 = contractRes.data.releasePsbt;

  const parsedPSBT = bitcoin.Psbt.fromBase64(releasePSBTBase64, {
    network: bitcoin,
  });

  parsedPSBT.signInput(0, childSell);

</code></pre>
<p><br><br>
<img src="/img/blog/under-the-hood/underthehood09.png" alt="this is the power of p2p exchanger" style="display:block; margin: auto; width: 40%;">
<br><br></p>
<p>Sasa Muuzaji anaweza kumalizia Muamala, kwa kuwasilisha saini zote mbili na Escrow Bitcoin Script.<br>
Tunaanza na njia ya MultiSig ya script (njia ya pili) na kuingiza <code>OP_FALSE</code> kwenye stack ili kuathiri IF statement kwa usahihi.</p>
<pre><code class="language-j">export const getFinalScript = (_inputIndex, input, bitcoinScript) =&gt; {
  const network = bitcoin;

  const payment = payments.p2wsh({
    network,
    redeem: {
      network,
      output: bitcoinScript,
      input: bitcoin.script.compile([
        input.partialSig[0].signature,
        input.partialSig[1].signature,
        opcodes.OP_FALSE,
      ]),
    },
  });

  parsedPSBT.finalizeInput(0, getFinalScript);

  const tx = parsedPSBT.extractTransaction().toHex();

</code></pre>
<p>Hatua ya mwisho: tuma Muamala uliokamilika kwenye API ya Peach:</p>
<pre><code class="language-j">  await session.post(&quot;v1/contract/&quot; + contract.id + &quot;/payment/confirm&quot;, {
    releaseTransaction: tx,
  });

</code></pre>
<p>Basi wapenzi, hivi ndivyo tunavyofanya biashara kwenye Peach kwa <strong>usalama na faragha ya hali ya juu!</strong></p>
<p class="date">October 23rd, 2025</p><p class="tags">Tagged with:<a href="/sw/blog/tag/bidhaa">Bidhaa</a><a href="/sw/blog/tag/p2p">P2P</a><a href="/sw/blog/tag/mwongozo">Mwongozo</a></p><p><a href="/sw/blog/">All blog posts</a></p></div></section></main><footer class="footer" id="footer"><div class="wrap"><div class="logo-section"><div class="logo"><img class="logo-image" src="/img/peach-footer-logo-e28fd7e07f654f43afd63c9b6ace3cdb.svg" alt="Peach logo"/><span>Made in Switzerland <img src="/img/flags/switzerland-icon.svg" style="width: 1rem; margin-left .5rem;"/></span></div><div class="company-info"> <img class="polyreg-image" src="/img/polyreg-52ec37fb80d0312b219110c05567ad3d.png" alt="Polyreg logo" width="120"/><p>Peach ni mwanachama wa SRO (Shirika la Udhibiti wa Kibinafsi) la Polyreg </p><p>Peach ni mtoa huduma wa kifedha aliyeidhinishwa nchini Uswisi na anafuata kikamilifu Sheria ya Kupambana na Ufuaji Fedha ya Uswisi. </p></div></div><div class="content"><div class="footer-box"><h6>Företag</h6><a href="/sw/join-us/">Gå med oss</a><a href="/sw/terms-and-conditions/">Villkor</a><a href="/sw/privacy-policy/">Integritetspolicy</a><a class="cookie-link" href="#" onclick="showCookiePopup(event)">Simamia mapendeleo ya vidakuzi</a></div><div class="footer-box"><h6>Kontakt</h6><a href="mailto:hello@peachbitcoin.com">E-post</a><a href="https://keys.openpgp.org/vks/v1/by-fingerprint/48339A19645E2E53488E0E5479E1B270FACD1BD2">PGP-nyckel</a></div><div class="footer-box"><h6>Ladda ner</h6><span>0.69.0 (294)</span><a href="/sw/apk/">APK</a><a href="https://testflight.apple.com/join/wfSPFEWG">iPhone</a><a href="https://play.google.com/store/apps/details?id=com.peachbitcoin.peach.mainnet">Android</a></div><div class="footer-box"><h6>Community</h6><a href="https://twitter.com/peachbitcoin" target="_blank" rel="noreferrer noopener">Twitter</a><a href="https://t.me/peachtopeach" target="_blank" rel="noreferrer noopener">Telegram</a><a href="https://discord.gg/ypeHz3SW54" target="_blank" rel="noreferrer noopener">Discord</a><a href="https://www.instagram.com/peachbitcoin/" target="_blank" rel="noreferrer noopener">Instagram</a><a href="https://snort.social/p/npub15369wu3wzzar5fclhecyqfv683x69n6nhlg7rxqnsg2dydgxflpq3apswl" target="_blank" rel="noreferrer noopener">Nostr</a><a href="https://github.com/Peach2Peach" target="_blank" rel="noreferrer noopener">Github</a><a href="https://www.youtube.com/@peachbitcoin" target="_blank" rel="noreferrer noopener">YouTube</a></div><div class="footer-box"><h6>Bitcoin</h6><a href="/bitcoin.pdf">Whitepaper</a><a href="https://docs.peachbitcoin.com">API-dokumentation</a></div><div class="footer-box"><h6>Tjäna Bitcoin</h6><a href="/sw/new-users/">Rekommendationskod</a><a href="/sw/for-businesses/">Bli en Affiliate</a></div></div></div></footer><style>#cookie-banner {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background-color: #120A07;
  color: #fff;
  padding: 15px 0;
  z-index: 9999;
  font-size: 14px;
}
#cookie-banner .cookie-container {
  width: 90%;
  max-width: 1200px;
  margin: 0 auto;
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  align-items: center;
}
#cookie-banner p {
  margin: 0;
  line-height: 1.4;
}
#cookie-banner .cookie-actions {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-top: 10px;
}
#cookie-banner button {
  padding: 10px 16px;
  color: #fff;
  background-color: #65A519;
  border: none;
  cursor: pointer;
  border-radius: 4px;
  font-size: 14px;
  transition: background-color 0.3s ease;
}
#cookie-banner button:hover {
  background-color: #65A519;
}
#cookie-banner button.reject {
  background-color: #DF321F;
}
#cookie-banner button.reject:hover {
  background-color: #DF321F;
}
#cookie-banner a.cookie-link {
  color: #fff;
  text-decoration: underline;
  font-size: 14px;
  margin-left: 8px;
  cursor: pointer;
}
#cookie-banner a.cookie-link:hover {
  text-decoration: none;
}
/* Popup overlay */
#cookie-popup {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.8);
  z-index: 10000;
  justify-content: center;
  align-items: center;
  color: #fff;
}
/* Contenitore del popup */
#cookie-popup-content {
  position: relative;
  background-color: #120A07;
  color:rgb(255, 255, 255);
  padding: 30px 20px 20px;
  border-radius: 10px;
  width: 80%;
  max-width: 600px;
  box-sizing: border-box;
}
/* Pulsante di chiusura */
#cookie-popup-content .close-btn {
  position: absolute;
  top: 10px;
  right: 10px;
  background: none;
  border: none;
  color: #fff;
  font-size: 24px;
  line-height: 1;
  cursor: pointer;
  padding: 0 5px;
}
#cookie-popup-content .close-btn:hover {
  color: #ccc;
}
/* Stile per ciascuna categoria di cookie */
.cookie-category {
  margin-bottom: 20px;
}
/* Migliora i checkbox e le label */
.cookie-category label {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  cursor: pointer;
  font-size: 15px;
}
.cookie-category input[type="checkbox"] {
  accent-color: #4CAF50;
  margin: 0;
  cursor: pointer;
}
.cookie-category p {
  margin: 4px 0 0 28px;
  font-size: 14px;
  line-height: 1.4;
  color: #ccc;
}
/* Bottone "Salva Preferenze" */
#cookie-popup-content button.save-btn {
  background-color: #4CAF50;
  border: none;
  padding: 10px 16px;
  color: #fff;
  font-size: 14px;
  cursor: pointer;
  border-radius: 4px;
  transition: background-color 0.3s ease;
}
#cookie-popup-content button.save-btn:hover {
  background-color: #43a047;
}
/* Media query per schermi più piccoli */
@media (max-width: 768px) {
  #cookie-banner .cookie-container {
    flex-direction: column;
    align-items: flex-start;
  }
  #cookie-banner .cookie-actions {
    margin-top: 10px;
    width: 100%;
    justify-content: flex-start;
    gap: 8px;
    flex-wrap: wrap;
  }
}

</style><div id="cookie-banner" style="display: none;"><div class="cookie-container"><p>Tunatumia vidakuzi kuboresha uzoefu wako. <a href="/privacy-policy" style="color: #4CAF50;">Soma zaidi</a></p><div class="cookie-actions"><button class="cookie-btn" onclick="acceptCookies()">Kubali Vidakuzi &amp; Endelea</button><button class="cookie-btn reject" onclick="rejectCookies()">Kataa Vidakuzi</button><a class="cookie-link" href="#" onclick="showCookiePopup(event)">Dhibiti Vidakuzi</a></div></div></div><div id="cookie-popup"><div id="cookie-popup-content"><button class="close-btn" type="button" onclick="closeCookiePopup()">×</button><h2>Dhibiti mapendeleo ya vidakuzi</h2><div class="cookie-category"><div class="switch-container"><span class="label-text">Vidakuzi Muhimu</span><label class="switch" for="necessary-cookies"><input type="checkbox" id="necessary-cookies" checked="checked" disabled="disabled"/><span class="slider"></span></label></div><p>Vidakuzi hivi ni muhimu kwa uendeshaji wa tovuti.</p></div><div class="cookie-category"><div class="switch-container"><span class="label-text">Vidakuzi vya Uchambuzi</span><label class="switch" for="analytics-cookies"><input type="checkbox" id="analytics-cookies"/><span class="slider"></span></label></div><p>Vidakuzi vya uchambuzi vinatusaidia kuelewa jinsi watumiaji wanavyoshirikiana na tovuti.</p></div><div class="cookie-category"><div class="switch-container"><span class="label-text">Vidakuzi vya Masoko</span><label class="switch" for="marketing-cookies"><input type="checkbox" id="marketing-cookies"/><span class="slider"></span></label></div><p>Vidakuzi vya masoko hutumika kukusanya taarifa za watumiaji</p></div><div style="text-align: right; margin-top: 20px;"><button class="save-btn" type="button" onclick="savePreferences()">Hifadhi Mapendeleo</button></div></div></div><script src="/js/main-15c0432b5e5f06cbab9e3fedcaae3032.js"></script><script>if ('serviceWorker' in navigator) {
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('/service-worker.js')
      .then(function(registration) {
        console.log('Service Worker registrato con successo:', registration);
      })
      .catch(function(error) {
        console.log('Registrazione del Service Worker fallita:', error);
      });
  });
} else {
  console.log('Service Worker non supportato in questo browser.');
}</script><script>window.onload = function() {
  setTimeout(function() {
    const languageLabel = document.querySelector('.language-label img');

    const languageMap = {
      'en': { text: 'English', flag: '/img/en-872bf10f0d1ed191b502494534bb329a.png' },
      'es': { text: 'Español', flag: '/img/es-b17fc8846b93c5446b10cd7824434504.png' },
      'de': { text: 'Deutsch', flag: '/img/de-0da84d0f3850d6e25088debeb3ade32c.png' },
      'it': { text: 'Italiano', flag: '/img/it-299996a0097e49e1bc4f312e380d3faa.png' },
      'fr': { text: 'Français', flag: '/img/fr-75a63faa5728ac4175214da6cd3c47f1.png' },
      'el': { text: 'Ελληνικά', flag: '/img/el-27d234921e954ed945c93bef880a07b6.png' },
      'hu': { text: 'Magyar', flag: '/img/hu-fc4c517f481932d60d59b56a8f0c322d.png' },
      'nl': { text: 'Nederlands', flag: '/img/nl-83a65573b2d26cdce16cab98f8c38db1.png' },
      'pl': { text: 'Polski', flag: '/img/pl-f7c03eb5351f5b2e33c9b29f1e200e38.png' },
      'pt': { text: 'Português', flag: '/img/pt-997fb3879120a45e1ba507a9e060a662.png' },
      'sw': { text: 'Kiswahili', flag: '/img/sw-cdf6e2b06778f5ac662fb25f3ca8eac0.png' },
      'uk': { text: 'Українська', flag: '/img/ua-f7a81ef67d0931a29f7e358bb99ef521.png' }
    };

    const currentPath = window.location.pathname;
    let currentLang = 'en';

    // Determinare la lingua corrente dal percorso
    for (const lang in languageMap) {
      if (currentPath.includes('/' + lang)) {
        currentLang = lang;
        break;
      }
    }

    // Aggiorna la bandiera e il testo dinamicamente
    if (languageLabel && languageMap[currentLang]) {
      languageLabel.src = languageMap[currentLang].flag;
    }
  }); // Ritardo per garantire che la pagina sia completamente caricata
};
</script><script>window.__ow = window.__ow || {};
window.__ow.organizationId = "8b099b27-4836-4896-9087-a7ed505dec79";
window.__ow.template_id = "b97be07a-7dcf-48af-8d69-a9dfae5dfc29";
window.__ow.integration_name = "manual_settings";
window.__ow.product_name = "chatbot";   
;(function(n,t,c){function i(n){return e._h?e._h.apply(null,n):e._q.push(n)}var e={_q:[],_h:null,_v:"2.0",on:function(){i(["on",c.call(arguments)])},once:function(){i(["once",c.call(arguments)])},off:function(){i(["off",c.call(arguments)])},get:function(){if(!e._h)throw new Error("[OpenWidget] You can't use getters before load.");return i(["get",c.call(arguments)])},call:function(){i(["call",c.call(arguments)])},init:function(){var n=t.createElement("script");n.async=!0,n.type="text/javascript",n.src="https://cdn.openwidget.com/openwidget.js",t.head.appendChild(n)}};!n.__ow.asyncInit&&e.init(),n.OpenWidget=n.OpenWidget||e}(window,document,[].slice))</script><noscript>You need to <a href="https://www.chatbot.com/help/chat-widget/enable-javascript-in-your-browser/" rel="noopener nofollow">enable JavaScript</a> in order to use the AI chatbot tool powered by <a href="https://www.chatbot.com/" rel="noopener nofollow" target="_blank">ChatBot</a></noscript><script>(function() {
  // Funzioni di utilità per gestire i cookie
  function setCookie(name, value, days) {
    var expires = "";
    if (days) {
      var date = new Date();
      date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
      expires = "; expires=" + date.toUTCString();
    }
    document.cookie = name + "=" + (value || "") + expires + "; path=/";
  }

  function getCookie(name) {
    var nameEQ = name + "=";
    var ca = document.cookie.split(';');
    for (var i = 0; i < ca.length; i++) {
      var c = ca[i];
      while (c.charAt(0) === ' ') c = c.substring(1, c.length);
      if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
    }
    return null;
  }

  // Controlla se il consenso è già stato dato per nascondere il banner
  function checkConsent() {
    if (getCookie('consent_necessary') === "true") {
      document.getElementById('cookie-banner').style.display = 'none';
    } else {
      document.getElementById('cookie-banner').style.display = 'flex';
    }
  }

  // Funzione per accettare tutti i cookie
  window.acceptCookies = function() {
    setCookie('consent_necessary', 'true', 365);
    setCookie('consent_analytics', 'true', 365);
    setCookie('consent_marketing', 'true', 365);
    document.getElementById('cookie-banner').style.display = 'none';
    document.getElementById('cookie-popup').style.display = 'none';
    window.dataLayer = window.dataLayer || [];
    window.dataLayer.push({event: 'cookie_consent', consent_analytics: true, consent_marketing: true});
  };

  // Funzione per rifiutare cookie opzionali (analytics e marketing)
  window.rejectCookies = function() {
    setCookie('consent_necessary', 'true', 365);
    setCookie('consent_analytics', 'false', 365);
    setCookie('consent_marketing', 'false', 365);
    document.getElementById('cookie-banner').style.display = 'none';
    document.getElementById('cookie-popup').style.display = 'none';
    window.dataLayer = window.dataLayer || [];
    window.dataLayer.push({event: 'cookie_consent', consent_analytics: false, consent_marketing: false});
  };

  // Mostra il popup per gestire le preferenze dei cookie
  window.showCookiePopup = function(event) {
    event.preventDefault();
    document.getElementById('cookie-popup').style.display = 'flex';
  };
  window.closeCookiePopup = function() {
  document.getElementById('cookie-popup').style.display = 'none';
  };

  // Salva le preferenze impostate nel popup
  window.savePreferences = function() {
    var analyticsConsent = document.getElementById('analytics-cookies').checked;
    var marketingConsent = document.getElementById('marketing-cookies').checked;
    setCookie('consent_necessary', 'true', 365);
    setCookie('consent_analytics', analyticsConsent ? 'true' : 'false', 365);
    setCookie('consent_marketing', marketingConsent ? 'true' : 'false', 365);
    document.getElementById('cookie-banner').style.display = 'none';
    document.getElementById('cookie-popup').style.display = 'none';
    window.dataLayer = window.dataLayer || [];
    window.dataLayer.push({event: 'cookie_consent', consent_analytics: analyticsConsent, consent_marketing: marketingConsent});
  };

  // Inizializza il controllo del consenso al caricamento della pagina
  checkConsent();
})();</script></body></html>
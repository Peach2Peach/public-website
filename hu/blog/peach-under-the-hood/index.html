<!DOCTYPE html><html lang="hu"><head><meta charset="UTF-8"/><meta http-equiv="X-UA-Compatible" content="ie=edge"/><meta http-equiv="X-Frame-Options" content="DENY"/><meta http-equiv="X-XSS-Protection" content="1; mode=block"/><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/><meta name="keywords" content="[&quot;Termék&quot;,&quot;P2P&quot;,&quot;útmutató&quot;,&quot;programozás&quot;,&quot;javascript&quot;,&quot;bitcoin&quot;]"/><meta name="description" content="Aaaaah, a Bitcoin — ez a csodálatos pénzforma, amely az alapvető tulajdonságainak köszönhetően virágzik. Mindannyian szeretjük, de azt is tudjuk, hogy az egyéni szuverenitás kockázatokkal jár: ha megosztod a seedjeidet, mindent elveszítesz. Ha rossz címre küldesz pénzt, soha nem látod viszont."/><meta property="og:locale" content="hu"/><meta property="og:site_name"/><meta property="og:title" content="Peach Bitcoin Exchange - Buy and Sell Bitcoin Anonymously and Without KYC"/><meta property="og:description" content="Peach Bitcoin - Buy Bitcoin with gift card, no verification. Exchange peer to peer for anonymous transactions. Learn how to buy and sell Bitcoin privately and without KYC. Manage your Bitcoin securely with our non-KYC platform."/><meta property="og:type" content="website"/><meta property="og:image" content="/img/blog/under-the-hood/peachmechanic2.png"/><meta property="og:image:secure_url" content="/img/blog/under-the-hood/peachmechanic2.png"/><meta property="og:image:width" content="1296"/><meta property="og:image:height" content="678"/><meta name="twitter:site" content="@peachbitcoin"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Peach Bitcoin a motorháztető alatt: technikai betekintés, miért ez a legbiztonságosabb P2P csere · Peach Bitcoin"/><meta name="twitter:description" content="Peach Bitcoin - Buy Bitcoin with gift card, no verification. Exchange peer to peer for anonymous transactions. Learn how to buy and sell Bitcoin privately and  without KYC. Manage your Bitcoin securely with our non-KYC platform."/><meta name="twitter:image" content="/img/blog/under-the-hood/peachmechanic2.png"/><meta name="msapplication-TileColor" content="#F56522"/><meta name="theme-color" content="#F56522"/><link rel="preload" as="font" crossorigin="crossorigin" href="/fonts/baloo-2-v16-latin-regular.woff2"/><link rel="preload" as="font" crossorigin="crossorigin" href="/fonts/baloo-2-v16-latin-600.woff2"/><link rel="preload" as="font" crossorigin="crossorigin" href="/fonts/baloo-2-v16-latin-800.woff2"/><link rel="apple-touch-icon" href="/img/favicon/apple-touch-icon.png"/><link rel="icon" href="/img/favicon/favicon.svg"/><link rel="manifest" href="/site.webmanifest"/><link rel="mask-icon" href="/img/favicon/safari-pinned-tab.svg" color="#F56522"/><link rel="stylesheet" href="/css/main-8c7d0a0965d37fafcf6e9215d363177f.css"/><title>Peach Bitcoin a motorháztető alatt: technikai betekintés, miért ez a legbiztonságosabb P2P csere · Peach Bitcoin</title><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KQHJRQKH');</script></head><body id="blog-peach-under-the-hood"><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KQHJRQKH" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><header class="header header-container" id="header"><div class="wrap"><a class="logo-link brand" href="/hu/"><img class="logo logo" src="/img/peach-bitcoin-145cd6c0079ccacc9c70c892060964d1.svg" alt="Peach Bitcoin"/></a><input id="show-menu" type="checkbox"/><label class="nav-toggle-label" id="nav-toggle" for="show-menu"><svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path class="line--1" d="M0 70l28-28c2-2 2-2 7-2h64"></path><path class="line--2" d="M0 50h99"></path><path class="line--3" d="M0 30l28 28c2 2 2 2 7 2h64"></path></svg></label><nav class="nav"><a href="/hu/how-it-works/">BTC vásárlás</a><a href="/hu/for-meetups/">Készpénzes BTC vásárlás</a><a href="/hu/for-businesses/">BTC eladása</a><a href="/hu/blog/">Blog</a><a href="/hu/support/">Támogatás</a><div class="language-selector"><input class="checkbox" type="checkbox" id="language-toggle"/><label class="language-label" for="language-toggle"><img class="flag-icon" src="/img/en-872bf10f0d1ed191b502494534bb329a.png" alt="UK Flag"/><img src="/img/dropdown_icon-fcd9aa7055472ef4a4e83b593450c048.svg" style="width: 1rem;" alt="Dropdown icon"/></label><ul class="language-dropdown"><li><a href="/"><img class="flag-icon" src="/img/en-872bf10f0d1ed191b502494534bb329a.png" alt="EN Flag"/><span>English</span></a></li><li><a href="/es"><img class="flag-icon" src="/img/es-b17fc8846b93c5446b10cd7824434504.png" alt="ES Flag"/><span>Español</span></a></li><li><a href="/de"><img class="flag-icon" src="/img/de-0da84d0f3850d6e25088debeb3ade32c.png" alt="DE Flag"/><span>Deutsch</span></a></li><li><a href="/it"><img class="flag-icon" src="/img/it-299996a0097e49e1bc4f312e380d3faa.png" alt="IT Flag"/><span>Italiano</span></a></li><li><a href="/fr"><img class="flag-icon" src="/img/fr-75a63faa5728ac4175214da6cd3c47f1.png" alt="FR Flag"/><span>Français</span></a></li><li><a href="/el"><img class="flag-icon" src="/img/el-27d234921e954ed945c93bef880a07b6.png" alt="GR Flag"/><span>Ελληνικά</span></a></li><li><a href="/hu"><img class="flag-icon" src="/img/hu-fc4c517f481932d60d59b56a8f0c322d.png" alt="HU Flag"/><span>Magyar</span></a></li><li><a href="/nl"><img class="flag-icon" src="/img/nl-83a65573b2d26cdce16cab98f8c38db1.png" alt="NL Flag"/><span>Nederlands</span></a></li><li><a href="/pl"><img class="flag-icon" src="/img/pl-f7c03eb5351f5b2e33c9b29f1e200e38.png" alt="PL Flag"/><span>Polski</span></a></li><li><a href="/pt"><img class="flag-icon" src="/img/pt-997fb3879120a45e1ba507a9e060a662.png" alt="PT Flag"/><span>Português</span></a></li><li><a href="/sw"><img class="flag-icon" src="/img/sw-cdf6e2b06778f5ac662fb25f3ca8eac0.png" alt="SW Flag"/><span>Kiswahili</span></a></li><li><a href="/uk"><img class="flag-icon" src="/img/ua-f7a81ef67d0931a29f7e358bb99ef521.png" alt="UA Flag"/><span>Українська</span></a></li></ul></div></nav></div></header><main class="main" id="main"><div id="header-anchor"></div><section class="wrap"><div class="content-wrap post"><h1 id="peach-bitcoin-a-motorhztet-alatt-technikai-betekints-mirt-ez-a-legbiztonsgosabb-p2p-csere">Peach Bitcoin a motorháztető alatt: technikai betekintés, miért ez a legbiztonságosabb P2P csere</h1>
<div class="video-wrapper">
  <iframe
    src="https://www.youtube.com/embed/UvdbHlsPmK0"
    title="PEACH VIDEO OF Under the Hood"
    frameborder="0"
    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
    referrerpolicy="strict-origin-when-cross-origin"
    allowfullscreen
  ></iframe>
</div>
<p>Aaaaah, a Bitcoin — ez a csodálatos pénzforma, amely az alapvető tulajdonságainak köszönhetően virágzik. Mindannyian szeretjük, de azt is tudjuk, hogy az egyéni szuverenitás kockázatokkal jár: ha megosztod a seedjeidet, mindent elveszítesz. Ha rossz címre küldesz pénzt, soha nem látod viszont.</p>
<p>Ezért olyan fontos a nyílt forráskód a Bitcoin ökoszisztémában — a Peach alkalmazás is elérhető a Githubon, bárki megvizsgálhatja!</p>
<p>Persze az, hogy valami nyílt forráskódú, nem jelenti azt, hogy mindenki bele fog nézni, vagy érteni fogja, hogyan működik.<br>
Ezért írom ezt a cikket: hogy <strong>megmutassam, mennyire biztonságos a Peach</strong>, és milyen lépések garantálják ezt.</p>
<h2 id="1-lps-hozz-ltre-egy-kyc-mentes-peach-fikot">1. lépés: Hozz létre egy KYC-mentes Peach fiókot</h2>
<p>Legyünk tiszták: a Bitcoin-seeded <strong>maga a Peach fiókod</strong>.</p>
<p>Ha használni szeretnéd a Peach-et, létre kell hoznod egy fiókot, ami abból áll, hogy megosztod a nyilvános kulcsodat, és bizonyítod, hogy birtoklod is azt.</p>
<p>Ehhez:</p>
<ul>
<li>1 - lekéred az aktuális időt (milliszekundumban) szövegként</li>
<li>2 - ezt a szöveget aláírod a privát kulcsoddal</li>
<li>3 - elküldöd a nyilvános kulcsot, az aktuális időt és az aláírást</li>
</ul>
<p>Emellett generálnod kell egy <code>uniqueId</code>-t, amely megakadályozza, hogy mások kiadjanak magukat érted.<br>
Ez akkor hasznos, ha például elveszted a seedjeidet, de meg akarod tartani ugyanazt a fiókot.<br>
De ebbe most ne mélyedjünk bele.</p>
<p><br><br>
<img src="/img/blog/under-the-hood/underthehood01.png" alt="this is the power of p2p exchanger" style="display:block; margin: auto; width: 70%;">
<br><br></p>
<p>Így néz ki ez JavaScript-ben:</p>
<pre><code class="language-j">
  const seed = randomBytes(64);

  const root = bip32.fromSeed(seed, bitcoin);
  const child = root.derivePath(&quot;m/0&quot;);
  const keyPair = ECPair.fromPrivateKey(child.privateKey, { network: bitcoin });

  const publicKeyHex = Buffer.from(keyPair.publicKey).toString(&quot;hex&quot;);

  const session = axios.create({
    baseURL: &quot;https://api.peachbitcoin.com/&quot;,
    httpAgent: new http.Agent({ keepAlive: false }),
    httpsAgent: new https.Agent({ keepAlive: false }),
  });

  const registerMessage = String(Date.now());
  const registerMessageSignature = signWithBtcPrivKey(registerMessage, keyPair);

  const resp = await session.post(&quot;v1/user/register&quot;, {
    publicKey: publicKeyHex,
    message: registerMessage,
    signature: registerMessageSignature,
    uniqueId: &quot;my_own_unique_id_random_12345&quot;,
  });

  const accessToken = resp.data.accessToken;

  session.defaults.headers.common[&quot;authorization&quot;] = accessToken;

</code></pre>
<p>Gratulálok! Most létrehoztál egy fiókot a Peach-en!<br>
A szerver ellenőrizte, hogy a megadott nyilvános kulcshoz tartozó Bitcoin-kulcspár ténylegesen a tiéd.</p>
<h2 id="2-lps-pgp-nyilvnos-kulcs-feltoeltse">2. lépés: PGP nyilvános kulcs feltöltése</h2>
<p>Sok titkosítás következik… de lesz némi visszafejtés is.<br>
A Bitcoin-kulcsok csak egyirányú titkosítást tesznek lehetővé, ezért PGP kulcsokra is szükség van a kétirányú kommunikációhoz.<br>
Ez elengedhetetlen a banki adatok és az üzenetek biztonságos kezeléséhez.</p>
<p>A PGP nyilvános kulcs feltöltése hasonló a Bitcoin kulcs feltöltéséhez, de van egy plusz lépés:<br>
a PGP kulcsot <strong>alá kell írni a Bitcoin privát kulcsoddal</strong>, hogy bizonyítsd: mindkettő a te tulajdonod.</p>
<p><br><br>
<img src="/img/blog/under-the-hood/underthehood02.png" alt="this is the power of p2p exchanger" style="display:block; margin: auto; width: 70%;">
<br><br></p>
<pre><code class="language-j">
const { privateKey: pgpPrivateKey, publicKey: pgpPublicKey } =
    await createPGPKey();

  const pgpPublicKeyMessageSignature = signWithBtcPrivKey(
    pgpPublicKey,
    keyPair
  );
  const setPgpKeysMessage = String(Date.now());

  const setPgpKeysMessageSignature = await signPGPMessage(
    pgpPrivateKey,
    setPgpKeysMessage
  );

  await session.patch(&quot;v1/user&quot;, {
    pgpPublicKey: pgpPublicKey, // the PGP Pub key
    signature: pgpPublicKeyMessageSignature, // the above signed by the BTC Key
    message: setPgpKeysMessage, // the current timestamp
    pgpSignature: setPgpKeysMessageSignature, // the above signed by the PGP Key
  });

</code></pre>
<p>Ezen a ponton a Peach már ismeri mindkét nyilvános kulcsodat — a Bitcoin- és a PGP-kulcsot!<br>
Ez nagyon fontos lesz a kereskedés során.</p>
<h2 id="tovbbi-lpsek">További lépések</h2>
<p>Mostantól két szereplőnk lesz: a Vevő és az Eladó.</p>
<p>A következő lépések:</p>
<ul>
<li>3.S Az Eladó létrehozza az eladási ajánlatot</li>
<li>4.S Az Eladó feltölti a Peach escrow-t</li>
<li>5.B A Vevő ajánlatot tesz az eladásra</li>
<li>5.S Az Eladó elfogadja az ajánlatot</li>
<li>6.B A Vevő jelzi, hogy megtörtént a fiat fizetés</li>
<li>6.S Az Eladó megerősíti a beérkezést</li>
</ul>
<h2 id="3s-lps-az-elad-ltrehozza-az-eladsi-ajnlatot">3.S lépés: Az Eladó létrehozza az eladási ajánlatot</h2>
<p>Egy eladási ajánlat létrehozása azt jelenti, hogy az Eladó jelezni akarja: hajlandó egy adott mennyiségű Bitcoint eladni.<br>
De ez nem minden — azt is meg kell határoznia, mit fogad el cserébe.</p>
<p>Egy eladási ajánlat tartalmazza:</p>
<ul>
<li>az eladni kívánt Bitcoin mennyiségét</li>
<li>az elfogadott fiat pénznemeket</li>
<li>az elfogadott fizetési módokat (készpénz, banki átutalás, Revolut stb.)</li>
<li>a prémiumot (az aktuális piaci ár fölötti százalék)</li>
</ul>
<p>Ha minden jól megy, egy vevő érdeklődni fog az ajánlat iránt, és ajánlatot tesz.<br>
Ekkor választania kell <strong>egy pénznemet és egy fizetési módot</strong> az Eladó által megadottak közül.<br>
Minél több lehetőséget kínál az Eladó, annál nagyobb az esélye, hogy vevőt talál.</p>
<p><br><br>
<img src="/img/blog/under-the-hood/underthehood03.png" alt="this is the power of p2p exchanger" style="display:block; margin: auto; width: 40%;">
<br><br></p>
<pre><code class="language-j">
const sats_to_sell = 21000;
  const sell_premium = 1; // 1%
  const payment_data_currency = &quot;EUR&quot;;
  const payment_data_method = &quot;wise&quot;;

  const { address: returnAddress } = bitcoin.payments.p2wpkh({
    pubkey: Buffer.from(keyPair.publicKey),
    network: bitcoin,
  });
  const sellOfferPaymentDataToEncrypt = JSON.stringify({
    reference: &quot;&quot;,
    userName: &quot;@myWiseIdTradingBot&quot;,
  });

  const paymentDataEncryptSHA256 = await sha256(sellOfferPaymentDataToEncrypt);

  const offerCreateRes = await session.post(&quot;v1/offer&quot;, {
    type: &quot;ask&quot;,
    amount: sats_to_sell,
    meansOfPayment: { [payment_data_currency]: [payment_data_method] }, // {&quot;EUR&quot;: [&quot;wise&quot;]}
    paymentData: {
      [payment_data_method]: { hashes: [paymentDataEncryptSHA256] },
    },
    returnAddress: returnAddress,
    premium: sell_premium,
  });

</code></pre>
<p>A kódban látható, hogy az Eladó 21 000 satoshit (0.00021 Bitcoin) kínál 1%-os prémiummal,<br>
eurót szeretne kapni Wise-on keresztül,<br>
de nem adja meg a Wise-azonosítóját — csak annak hash-ét.<br>
A Peach tehát sosem ismeri meg a fizetési részleteit, így megmarad az anonimitás.<br>
Az Eladó megad egy <strong>visszautalási címet</strong> is, arra az esetre, ha visszatérítés szükséges.</p>
<h2 id="4s-lps-az-elad-feltoelti-az-escrow-t">4.S lépés: Az Eladó feltölti az escrow-t</h2>
<p>Sikeres API-hívás után az Eladó megkapja az ajánlat azonosítóját:</p>
<pre><code class="language-j">const sellOfferId = offerCreateRes.data.id;

</code></pre>
<p>Ez az azonosító fontos — őrizd meg.<br>
Az ajánlat még nem nyilvános: a vevők még nem láthatják.<br>
Előbb az escrow-t kell feltölteni.</p>
<p>Az escrow olyan, mint egy trezor, amit <strong>a Peach és az Eladó együtt</strong> tud kinyitni.<br>
A Bitcoin ide kerül, és itt marad biztonságban a tranzakció végéig.<br>
Mivel ez egy Bitcoin-szkript (P2WSH cím), a Peach-nek szüksége van az Eladó nyilvános kulcsára a létrehozáshoz.</p>
<p>Az Eladó elküldi a használandó nyilvános kulcsot,<br>
a Peach pedig kiválasztja a sajátját, és elkészíti a címet.</p>
<p><br><br>
<img src="/img/blog/under-the-hood/underthehood04.png" alt="this is the power of p2p exchanger" style="display:block; margin: auto; width: 40%;">
<br><br></p>
<pre><code class="language-j">const childSell = root.derivePath(`m/84'/0'/0'/${sellOfferId}'`);

  const keyPairSellOffer = ECPair.fromPrivateKey(childSell.privateKey, {
    network: bitcoin,
  });

  const sellOfferPublicKey = Buffer.from(keyPairSellOffer.publicKey).toString(
    &quot;hex&quot;
  );

  const escrowCreateRes = await session.post(
    &quot;v1/offer/&quot; + sellOfferId + &quot;/escrow&quot;,
    {
      publicKey: sellOfferPublicKey,
    }
  );

  const escrowAddress = escrowCreateRes.data.escrows.bitcoin;

  const escrowPeachPublicKey =
    escrowCreateRes.data.escrowPeachPublicKey.bitcoin;

</code></pre>
<p>A kódban az Eladó az ajánlat azonosítójából derivál egy új kulcspárt.<br>
Ez biztonságos és reprodukálható módszer.</p>
<p>Miután a kulcs elküldésre került, az API visszaadja a címet, ahová az Eladónak el kell küldenie a 21 000 satoshit.<br>
De nem kell vakon megbízni — ellenőrizheted magad is a címet.</p>
<p>Nézzük is meg!</p>
<p>Az API visszaküldi a Peach által használt nyilvános kulcsot is, így <strong>újra létre tudjuk hozni a címet</strong> a Bitcoin-szkriptből.</p>
<pre><code class="language-j">   OP_IF
       ${script.number.encode(4320).toString(&quot;hex&quot;)}
       OP_CHECKSEQUENCEVERIFY
       OP_DROP
   OP_ELSE
       ${sellerPublicKey}
       OP_CHECKSIGVERIFY
   OP_ENDIF
   ${peachPublicKey}
   OP_CHECKSIG
</code></pre>
<p>Az escrow-szkript így néz ki:</p>
<ul>
<li>mindig szükséges a Peach aláírása</li>
<li>ezen felül:
<ul>
<li>az Eladó aláírása is kell</li>
<li>vagy 4320 blokk eltelte azóta, hogy a Bitcoin letétbe került</li>
</ul>
</li>
</ul>
<p>Miért 4320 blokk?<br>
Ez körülbelül <strong>30 napnyi</strong> bányászat (1 blokk / 10 perc).<br>
Miért kell, hogy Peach egyedül is aláírhasson 30 nap után?<br>
Mert előfordulhat, hogy egy eladó inaktív, elveszíti a kulcsait stb.</p>
<p>A Peach kiváló hírnévnek örvend a Vevők és Eladók pénzének kezelésében.</p>
<p>A szkript létrehozása után ellenőrizheted, hogy a P2WSH-cím megegyezik-e az API által visszaadott címmel.</p>
<pre><code class="language-j">  const multisigScript = bitcoin.script.compile([
    Buffer.from(sellOfferPublicKey, &quot;hex&quot;),
    bitcoin.opcodes.OP_CHECKSIGVERIFY,
  ]);

  const timelockScript = bitcoin.script.compile([
    bitcoin.script.number.encode(4320),
    bitcoin.opcodes.OP_CHECKSEQUENCEVERIFY,
    bitcoin.opcodes.OP_DROP,
  ]);

  const redeemScript = bitcoin.script.compile([
    bitcoin.opcodes.OP_IF,
    ...timelockScript,
    bitcoin.opcodes.OP_ELSE,
    ...multisigScript,
    bitcoin.opcodes.OP_ENDIF,
    Buffer.from(escrowPeachPublicKey, &quot;hex&quot;),
    bitcoin.opcodes.OP_CHECKSIG,
  ]);

  const escrowPayment = bitcoin.payments.p2wsh({
    redeem: { output: redeemScript },
    network: bitcoin,
  });

  console.log(&quot;Addresses Match:&quot;, escrowPayment.address === escrowAddress);

</code></pre>
<p>Tökéletes!<br>
Most már csak el kell küldeni a tranzakciót a Bitcoin-hálózaton, és megvárni, amíg az escrow finanszírozása megerősítést nyer.</p>
<pre><code class="language-j">  while (true) {
    const fundingStatusRes = await session.get(
      &quot;v1/offer/&quot; + sellOfferId + &quot;/escrow&quot;
    );
    if (fundingStatusRes.data.funding.status === &quot;FUNDED&quot;) {
      break;
    }
  }

</code></pre>
<p>Egy blokknyi megerősítés után az ajánlat nyilvánossá válik, és a vevők kapcsolatba léphetnek vele.</p>
<h2 id="5b-lps-a-vev-ajnlatot-tesz">5.B lépés: A Vevő ajánlatot tesz</h2>
<p>Most a Vevő következik!</p>
<p>Először lekérdezi az elérhető eladási ajánlatokat:</p>
<pre><code class="language-j">const sellOffers = await session.get(&quot;v069/sellOffer&quot;);
</code></pre>
<p>Tegyük fel egyszerűség kedvéért, hogy a Vevőt az első ajánlat érdekli.</p>
<pre><code class="language-j">const sellOfferToTradeRequestId = sellOffers.data.offers[0].id;
</code></pre>
<p>A Vevő ajánlatot szeretne tenni — jelezve, hogy hajlandó az Eladó feltételei szerint vásárolni.<br>
Egyszerűnek tűnik, de ez <strong>a legösszetettebb lépés</strong> az egész folyamatban.</p>
<p>A Vevőnek meg kell adnia:</p>
<ul>
<li>a választott fizetési módot</li>
<li>a választott pénznemet</li>
<li>egy szimmetrikus kulcsot (a titkosított kommunikációhoz) — titkosítva</li>
<li>ennek az aláírását</li>
<li>a titkosított fizetési adatokat</li>
<li>azok aláírását</li>
<li>a Bitcoin fogadó címet</li>
<li>a tulajdon igazolását (BIP 322 segítségével)</li>
<li>a maximális bányadíjat, amit hajlandó fizetni</li>
</ul>
<p>Ez rengeteg, ugye?<br>
De épp ez teszi a Peach-et rendkívül biztonságossá!<br>
Menjünk végig lépésről lépésre.</p>
<h3 id="fizetsi-md-s-pnznem">Fizetési mód és pénznem:</h3>
<p>Ez a legegyszerűbb rész:</p>
<pre><code class="language-j">  const payment_data_currency = &quot;EUR&quot;;
  const payment_data_method = &quot;wise&quot;;

</code></pre>
<h3 id="szimmetrikus-kulcs">Szimmetrikus kulcs:</h3>
<p>A szimmetrikus kulcs AES256 kétirányú titkosítást biztosít: ugyanazzal a kulccsal lehet titkosítani és visszafejteni.</p>
<pre><code class="language-j">async function decryptDataWithSymmetricKey(encryptedMessage, symmetricKey) {
  const message = await openpgp.readMessage({
    armoredMessage: encryptedMessage,
  });

  const { data: decrypted } = await openpgp.decrypt({
    message,
    passwords: [symmetricKey],
    format: &quot;utf8&quot;,
  });

  return decrypted;
}

async function encryptDataWithSymmetricKey(data, symmetricKey) {
  const message = await openpgp.createMessage({ text: data });
  const encrypted = await openpgp.encrypt({
    message,
    passwords: [symmetricKey],
    format: &quot;armored&quot;,
    config: {
      preferredSymmetricAlgorithm: openpgp.enums.symmetric.aes256,
    },
  });
  return encrypted;
}

</code></pre>
<p>Egy véletlenszerű szám generálásával hozható létre:</p>
<pre><code class="language-j">  const symmetricKey = randomBytes(32);
  const symmetricKeyHex = symmetricKey.toString(&quot;hex&quot;);

</code></pre>
<p>De ezt a kulcsot <strong>nem lehet nyíltan elküldeni</strong>.<br>
Úgy kell titkosítani, hogy csak a Vevő és az Eladó tudja visszafejteni —<br>
a már megadott PGP nyilvános kulcsok segítségével.</p>
<pre><code class="language-j">async function encryptForMultipleRecipients(secret, publicKeysArmored) {
  const publicKeys = await Promise.all(
    publicKeysArmored.map((armored) =&gt; openpgp.readKey({ armoredKey: armored }))
  );
  const message = await openpgp.createMessage({ text: secret });

  const encrypted = await openpgp.encrypt({
    message,
    encryptionKeys: publicKeys,
  });

  return encrypted;
}

  const matchingUserPgpPubKey = sellOffers.data.offers[0].user.pgpPublicKey;

  const symmetricKeyEncrypted = await encryptForMultipleRecipients(
    symmetricKeyHex,
    [pgpPublicKey, matchingUserPgpPubKey]
  );

</code></pre>
<p>És hogy az Eladó biztos lehessen benne, hogy a kulcs valóban a Vevőtől származik,<br>
a Vevő aláírja a PGP kulcsával:</p>
<pre><code class="language-j">  const symmetricKeySignature = await signPGPMessage(
    pgpPrivateKey,
    symmetricKeyHex
  );

</code></pre>
<h3 id="fizetsi-adatok">Fizetési adatok:</h3>
<p>Ez a legérzékenyebb rész: a fiat fizetéshez szükséges adatok (IBAN, Revolut-azonosító stb.).<br>
A Vevő ezeket titkosítja a szimmetrikus kulccsal, így csak az Eladó tudja visszafejteni.</p>
<pre><code class="language-j">const paymentDataToEncrypt = JSON.stringify({
    reference: &quot;&quot;,
    userName: &quot;@buyerWiseId&quot;,
  });

const paymentDataEncrypted = await encryptDataWithSymmetricKey(
paymentDataToEncrypt,
symmetricKeyHex
);

const paymentDataSignature = await signPGPMessage(
pgpPrivateKey,
paymentDataToEncrypt
);

</code></pre>
<h3 id="fogad-cm-s-tulajdon-igazolsa">Fogadó cím és tulajdon igazolása:</h3>
<p>Meg kell adni, hová szeretnéd megkapni a Bitcoint.<br>
A cím létrehozása egyszerű, de <strong>bizonyítani</strong>, hogy a tiéd — bonyolultabb.<br>
Ez megfelelőségi és biztonsági szempontból is fontos (különösen a 2025 szeptemberében felfedezett „address replacement” támadás ellen).</p>
<p>A bizonyítás a <strong>BIP-322</strong> szabvány alapján történik: aláírsz egy üzenetet a privát kulcsoddal,<br>
majd az ellenőrizhető a cím alapján.</p>
<pre><code class="language-j">  const { address } = bitcoin.payments.p2wpkh({
    pubkey: Buffer.from(keyPair.publicKey),
    network: bitcoin,
  });

  const ownershipMessage =
    &quot;I confirm that only I, peach&quot; +
    publicKeyHex.slice(0, 8) +
    &quot;, control the address &quot; +
    address;

  const releaseAddressSignature = signWithBIP322(
    wif,
    address,
    ownershipMessage
  );

</code></pre>
<h3 id="maximlis-bnyadj">Maximális bányadíj</h3>
<p>A Vevő korlátozhatja, hogy mennyi díjat hajlandó fizetni a végső tranzakcióban.</p>
<h3 id="ajnlat-elkueldse">Ajánlat elküldése</h3>
<p>Most, hogy minden kész, a Vevő elküldi az ajánlatot.</p>
<pre><code class="language-j">  await session.post(
    &quot;v069/sellOffer/&quot; + sellOfferToTradeRequestId + &quot;/tradeRequestPerformed&quot;,
    {
      paymentMethod: payment_data_method,
      currency: payment_data_currency,
      paymentDataHashed: paymentDataToEncryptSHA256,
      paymentDataEncrypted: paymentDataEncrypted,
      paymentDataSignature: paymentDataSignature,
      symmetricKeyEncrypted: symmetricKeyEncrypted,
      symmetricKeySignature: symmetricKeySignature,
      maxMiningFeeRate: 2, // sats/vb
      releaseAddress: address,
      releaseAddressMessageSignature: releaseAddressSignature,
    }
  );

</code></pre>
<p><br><br>
<img src="/img/blog/under-the-hood/underthehood05.png" alt="this is the power of p2p exchanger" style="display:block; margin: auto; width: 40%;">
<br><br></p>
<p>A labda most az Eladó térfelén van.</p>
<h2 id="5s-lps-az-elad-elfogadja-az-ajnlatot">5.S lépés: Az Eladó elfogadja az ajánlatot</h2>
<p>Az Eladó megvárta, hogy a Vevő reagáljon.<br>
Most lekérdezi az ajánlatokra érkezett kérelmeket:</p>
<pre><code class="language-j">const receivedTradeRequestRequest = await session.get(
    &quot;v069/sellOffer/&quot; + sellOfferId + &quot;/tradeRequestReceived&quot;
  );

  const tradeReq = receivedTradeRequestRequest.data[0];

</code></pre>
<p>Ha egy ajánlat szimpatikus, az Eladó megosztja <strong>a saját fizetési adatait</strong> is, hogy a Vevő tudja, hová küldje a fiat pénzt.</p>
<p>Mivel a Vevő már küldött egy szimmetrikus kulcsot (PGP-vel titkosítva), az Eladó visszafejtheti,<br>
és ugyanazzal a kulccsal titkosíthatja a saját fizetési adatait.</p>
<pre><code class="language-j">  const receivedSymmetricKey = await decryptWithPrivateKey(
    tradeReq.symmetricKeyEncrypted,
    pgpPrivateKey
  );

  const sellOfferPaymentDataEncrypted = await encryptDataWithSymmetricKey(
    sellOfferPaymentDataToEncrypt,
    receivedSymmetricKey
  );

  const sellOfferPaymentDataSignature = await signPGPMessage(
    pgpPrivateKey,
    sellOfferPaymentDataToEncrypt
  );

</code></pre>
<p>Ezzel az Eladó készen áll az ajánlat elfogadására, és a csere hivatalosan elindul!</p>
<p><br><br>
<img src="/img/blog/under-the-hood/underthehood06.png" alt="this is the power of p2p exchanger" style="display:block; margin: auto; width: 40%;">
<br><br></p>
<pre><code class="language-j">  await session.post(
    &quot;v069/sellOffer/&quot; +
      sellOfferId +
      &quot;/tradeRequestReceived/&quot; +
      tradeReq.userId +
      &quot;/accept&quot;,
    {
      paymentDataEncrypted: sellOfferPaymentDataEncrypted,
      paymentDataSignature: sellOfferPaymentDataSignature,
      paymentData: {
        [payment_data_method]: { hashes: [paymentDataEncryptSHA256] },
      },
    }
  );

</code></pre>
<p>Ha ez így zavaros, íme egy szemléltető ábra:</p>
<p><br><br>
<img src="/img/blog/under-the-hood/underthehood07.png" alt="this is the power of p2p exchanger" style="display:block; margin: auto; width: 90%;">
<br><br></p>
<h2 id="6b-lps-a-vev-jelzi-hogy-a-fizets-megtoertnt">6.B lépés: A Vevő jelzi, hogy a fizetés megtörtént</h2>
<p>A Vevő lekérheti az <strong>aktív szerződéseit</strong> (az elfogadott ajánlatokat) az API <code>contract summaries</code> végpontján keresztül:</p>
<pre><code class="language-j">  const contractsRes = await session.get(&quot;v1/contracts/summary&quot;);
  const contract = contractsRes.data.find((obj) =&gt;
    obj.id.startsWith(sellOfferToTradeRequestId + &quot;-&quot;)
  );

  if (contract.tradeStatus !== &quot;paymentRequired&quot;) throw Error;
</code></pre>
<p>Ha egy szerződés állapota <strong>„paymentRequired”</strong>, az azt jelenti, hogy a fiat fizetést még el kell küldenie.</p>
<p>Ekkor a Vevő visszafejti az Eladó fizetési adatait a korábban használt szimmetrikus kulccsal.<br>
Ha ezt elvesztette, PGP privát kulcsával is visszafejtheti.</p>
<pre><code class="language-j">
  const contractRes = await session.get(&quot;v1/contract/&quot; + contract.id);

  const receivedSymmetricKey = await decryptWithPrivateKey(
    contractRes.data.symmetricKeyEncrypted,
    pgpPrivateKey
  );

  if (receivedSymmetricKey !== symmetricKeyHex) throw Error;

  const decryptedSellerPaymentData = await decryptDataWithSymmetricKey(
    contractRes.data.paymentDataEncrypted,
    receivedSymmetricKey
  );

  console.log(&quot;Seller Payment Data &quot;, JSON.parse(decryptedSellerPaymentData));
</code></pre>
<p>Ez a lépés a Peach-en kívül történik:<br>
a Vevő megnyitja a banki alkalmazását, és elküldi az átutalást az Eladó által megadott adatokkal.</p>
<p>Ha aggódnál: a Bitcoin már az escrow-ban van, amit csak a Peach és az Eladó együtt tud feloldani.<br>
Az escrow címét a szerződésből lekérheted, és ellenőrizheted a Bitcoin-blokkláncon.</p>
<p>Miután a fizetés megtörtént, a Vevő jelzi:</p>
<pre><code class="language-j">  const confirmPaymentRes = await session.post(
    &quot;v1/contract/&quot; + contract.id + &quot;/payment/confirm&quot;
  );
</code></pre>
<p><br><br>
<img src="/img/blog/under-the-hood/underthehood08.png" alt="this is the power of p2p exchanger" style="display:block; margin: auto; width: 40%;">
<br><br></p>
<p>Ezzel a Vevő feladata véget ért.<br>
Most az Eladó következik, aki megerősíti a beérkezést, és felszabadítja a Bitcoint.</p>
<h2 id="6s-lps-az-elad-megersti-a-fizets-berkezst">6.S lépés: Az Eladó megerősíti a fizetés beérkezését</h2>
<p>Az Eladó lekérdezi a szerződéseit.</p>
<pre><code class="language-j">  const contractsRes = await session.get(&quot;v1/contracts/summary&quot;);
  const contract = contractsRes.data[0];

  const contractRes = await session.get(&quot;v1/contract/&quot; + contract.id);

</code></pre>
<p>A szerződés API válasza tartalmaz egy <strong>részben aláírt Bitcoin tranzakciót (PSBT)</strong>,<br>
ami a Bitcoin-t az escrow-ból a Vevő címére küldi.<br>
Ez már a Peach által alá van írva — csak az Eladó aláírása hiányzik.</p>
<pre><code class="language-j">  const releasePSBTBase64 = contractRes.data.releasePsbt;

  const parsedPSBT = bitcoin.Psbt.fromBase64(releasePSBTBase64, {
    network: bitcoin,
  });

  parsedPSBT.signInput(0, childSell);

</code></pre>
<p><br><br>
<img src="/img/blog/under-the-hood/underthehood09.png" alt="this is the power of p2p exchanger" style="display:block; margin: auto; width: 40%;">
<br><br></p>
<p>Az Eladó hozzáadja a saját aláírását és a szkriptet.<br>
Mivel a <strong>MultiSig</strong> útvonalat használjuk, a verembe <code>OP_FALSE</code> kerül, hogy az IF feltétel helyesen értékelődjön.</p>
<pre><code class="language-j">export const getFinalScript = (_inputIndex, input, bitcoinScript) =&gt; {
  const network = bitcoin;

  const payment = payments.p2wsh({
    network,
    redeem: {
      network,
      output: bitcoinScript,
      input: bitcoin.script.compile([
        input.partialSig[0].signature,
        input.partialSig[1].signature,
        opcodes.OP_FALSE,
      ]),
    },
  });

  parsedPSBT.finalizeInput(0, getFinalScript);

  const tx = parsedPSBT.extractTransaction().toHex();

</code></pre>
<p>Végül az Eladó elküldi a teljes tranzakciót az API-nak:</p>
<pre><code class="language-j">  await session.post(&quot;v1/contract/&quot; + contract.id + &quot;/payment/confirm&quot;, {
    releaseTransaction: tx,
  });

</code></pre>
<p>Hölgyeim és uraim, így zajlik egy Peach csere —  <strong>a lehető legnagyobb biztonsággal és adatvédelemmel!</strong></p>
<p class="date">October 23rd, 2025</p><p class="tags">Tagged with:<a href="/hu/blog/tag/termk">Termék</a><a href="/hu/blog/tag/p2p">P2P</a><a href="/hu/blog/tag/tmutat">Útmutató</a></p><p><a href="/hu/blog/">All blog posts</a></p></div></section></main><footer class="footer" id="footer"><div class="wrap"><div class="logo-section"><div class="logo"><img class="logo-image" src="/img/peach-footer-logo-e28fd7e07f654f43afd63c9b6ace3cdb.svg" alt="Peach logo"/><span>Made in Switzerland <img src="/img/flags/switzerland-icon.svg" style="width: 1rem; margin-left .5rem;"/></span></div><div class="company-info"> <img class="polyreg-image" src="/img/polyreg-52ec37fb80d0312b219110c05567ad3d.png" alt="Polyreg logo" width="120"/><p>A Peach a Polyreg SRO (Önszabályozó Szervezet) tagja </p><p>A Peach egy engedéllyel rendelkező pénzügyi szolgáltató Svájcban, és teljes mértékben megfelel a svájci pénzmosás elleni törvénynek. </p></div></div><div class="content"><div class="footer-box"><h6>Cég</h6><a href="/hu/join-us/">Csatlakozz hozzánk</a><a href="/hu/terms-and-conditions/">ÁSZF</a><a href="/hu/privacy-policy/">Adatvédelmi Irányelvek</a><a class="cookie-link" href="#" onclick="showCookiePopup(event)">Cookie-beállítások kezelése</a></div><div class="footer-box"><h6>Kapcsolat</h6><a href="mailto:hello@peachbitcoin.com">E-mail</a><a href="https://keys.openpgp.org/vks/v1/by-fingerprint/48339A19645E2E53488E0E5479E1B270FACD1BD2">PGP kulcs</a></div><div class="footer-box"><h6>Letöltés</h6><span>0.69.0 (294)</span><a href="/hu/apk/">APK</a><a href="https://testflight.apple.com/join/wfSPFEWG">iPhone</a><a href="https://play.google.com/store/apps/details?id=com.peachbitcoin.peach.mainnet">Android</a></div><div class="footer-box"><h6>Közösség</h6><a href="https://twitter.com/peachbitcoin" target="_blank" rel="noreferrer noopener">Twitter</a><a href="https://t.me/peachtopeach" target="_blank" rel="noreferrer noopener">Telegram</a><a href="https://discord.gg/ypeHz3SW54" target="_blank" rel="noreferrer noopener">Discord</a><a href="https://www.instagram.com/peachbitcoin/" target="_blank" rel="noreferrer noopener">Instagram</a><a href="https://snort.social/p/npub15369wu3wzzar5fclhecyqfv683x69n6nhlg7rxqnsg2dydgxflpq3apswl" target="_blank" rel="noreferrer noopener">Nostr</a><a href="https://github.com/Peach2Peach" target="_blank" rel="noreferrer noopener">Github</a><a href="https://www.youtube.com/@peachbitcoin" target="_blank" rel="noreferrer noopener">YouTube</a></div><div class="footer-box"><h6>Bitcoin</h6><a href="/bitcoin.pdf">Fehér könyv</a><a href="https://docs.peachbitcoin.com">API Dokumentáció</a></div><div class="footer-box"><h6>Keress Bitcoint</h6><a href="/hu/new-users/">Ajánlói Kód</a><a href="/hu/for-businesses/">Légy Partner</a></div></div></div></footer><style>#cookie-banner {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background-color: #120A07;
  color: #fff;
  padding: 15px 0;
  z-index: 9999;
  font-size: 14px;
}
#cookie-banner .cookie-container {
  width: 90%;
  max-width: 1200px;
  margin: 0 auto;
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  align-items: center;
}
#cookie-banner p {
  margin: 0;
  line-height: 1.4;
}
#cookie-banner .cookie-actions {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-top: 10px;
}
#cookie-banner button {
  padding: 10px 16px;
  color: #fff;
  background-color: #65A519;
  border: none;
  cursor: pointer;
  border-radius: 4px;
  font-size: 14px;
  transition: background-color 0.3s ease;
}
#cookie-banner button:hover {
  background-color: #65A519;
}
#cookie-banner button.reject {
  background-color: #DF321F;
}
#cookie-banner button.reject:hover {
  background-color: #DF321F;
}
#cookie-banner a.cookie-link {
  color: #fff;
  text-decoration: underline;
  font-size: 14px;
  margin-left: 8px;
  cursor: pointer;
}
#cookie-banner a.cookie-link:hover {
  text-decoration: none;
}
/* Popup overlay */
#cookie-popup {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.8);
  z-index: 10000;
  justify-content: center;
  align-items: center;
  color: #fff;
}
/* Contenitore del popup */
#cookie-popup-content {
  position: relative;
  background-color: #120A07;
  color:rgb(255, 255, 255);
  padding: 30px 20px 20px;
  border-radius: 10px;
  width: 80%;
  max-width: 600px;
  box-sizing: border-box;
}
/* Pulsante di chiusura */
#cookie-popup-content .close-btn {
  position: absolute;
  top: 10px;
  right: 10px;
  background: none;
  border: none;
  color: #fff;
  font-size: 24px;
  line-height: 1;
  cursor: pointer;
  padding: 0 5px;
}
#cookie-popup-content .close-btn:hover {
  color: #ccc;
}
/* Stile per ciascuna categoria di cookie */
.cookie-category {
  margin-bottom: 20px;
}
/* Migliora i checkbox e le label */
.cookie-category label {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  cursor: pointer;
  font-size: 15px;
}
.cookie-category input[type="checkbox"] {
  accent-color: #4CAF50;
  margin: 0;
  cursor: pointer;
}
.cookie-category p {
  margin: 4px 0 0 28px;
  font-size: 14px;
  line-height: 1.4;
  color: #ccc;
}
/* Bottone "Salva Preferenze" */
#cookie-popup-content button.save-btn {
  background-color: #4CAF50;
  border: none;
  padding: 10px 16px;
  color: #fff;
  font-size: 14px;
  cursor: pointer;
  border-radius: 4px;
  transition: background-color 0.3s ease;
}
#cookie-popup-content button.save-btn:hover {
  background-color: #43a047;
}
/* Media query per schermi più piccoli */
@media (max-width: 768px) {
  #cookie-banner .cookie-container {
    flex-direction: column;
    align-items: flex-start;
  }
  #cookie-banner .cookie-actions {
    margin-top: 10px;
    width: 100%;
    justify-content: flex-start;
    gap: 8px;
    flex-wrap: wrap;
  }
}

</style><div id="cookie-banner" style="display: none;"><div class="cookie-container"><p>Sütiket használunk, hogy javítsuk a felhasználói élményét. <a href="/privacy-policy" style="color: #4CAF50;">Tudjon meg többet</a></p><div class="cookie-actions"><button class="cookie-btn" onclick="acceptCookies()">Sütik elfogadása és folytatás</button><button class="cookie-btn reject" onclick="rejectCookies()">Sütik elutasítása</button><a class="cookie-link" href="#" onclick="showCookiePopup(event)">Sütik kezelése</a></div></div></div><div id="cookie-popup"><div id="cookie-popup-content"><button class="close-btn" type="button" onclick="closeCookiePopup()">×</button><h2>Süti beállítások kezelése</h2><div class="cookie-category"><div class="switch-container"><span class="label-text">Szükséges sütik</span><label class="switch" for="necessary-cookies"><input type="checkbox" id="necessary-cookies" checked="checked" disabled="disabled"/><span class="slider"></span></label></div><p>Ezek a sütik elengedhetetlenek a weboldal működéséhez.</p></div><div class="cookie-category"><div class="switch-container"><span class="label-text">Analitikai sütik</span><label class="switch" for="analytics-cookies"><input type="checkbox" id="analytics-cookies"/><span class="slider"></span></label></div><p>Az analitikai sütik segítenek megérteni, hogyan lépnek interakcióba a felhasználók a weboldallal.</p></div><div class="cookie-category"><div class="switch-container"><span class="label-text">Marketing sütik</span><label class="switch" for="marketing-cookies"><input type="checkbox" id="marketing-cookies"/><span class="slider"></span></label></div><p>A marketing sütik a felhasználói információk gyűjtésére szolgálnak</p></div><div style="text-align: right; margin-top: 20px;"><button class="save-btn" type="button" onclick="savePreferences()">Beállítások mentése</button></div></div></div><script src="/js/main-15c0432b5e5f06cbab9e3fedcaae3032.js"></script><script>if ('serviceWorker' in navigator) {
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('/service-worker.js')
      .then(function(registration) {
        console.log('Service Worker registrato con successo:', registration);
      })
      .catch(function(error) {
        console.log('Registrazione del Service Worker fallita:', error);
      });
  });
} else {
  console.log('Service Worker non supportato in questo browser.');
}</script><script>window.onload = function() {
  setTimeout(function() {
    const languageLabel = document.querySelector('.language-label img');

    const languageMap = {
      'en': { text: 'English', flag: '/img/en-872bf10f0d1ed191b502494534bb329a.png' },
      'es': { text: 'Español', flag: '/img/es-b17fc8846b93c5446b10cd7824434504.png' },
      'de': { text: 'Deutsch', flag: '/img/de-0da84d0f3850d6e25088debeb3ade32c.png' },
      'it': { text: 'Italiano', flag: '/img/it-299996a0097e49e1bc4f312e380d3faa.png' },
      'fr': { text: 'Français', flag: '/img/fr-75a63faa5728ac4175214da6cd3c47f1.png' },
      'el': { text: 'Ελληνικά', flag: '/img/el-27d234921e954ed945c93bef880a07b6.png' },
      'hu': { text: 'Magyar', flag: '/img/hu-fc4c517f481932d60d59b56a8f0c322d.png' },
      'nl': { text: 'Nederlands', flag: '/img/nl-83a65573b2d26cdce16cab98f8c38db1.png' },
      'pl': { text: 'Polski', flag: '/img/pl-f7c03eb5351f5b2e33c9b29f1e200e38.png' },
      'pt': { text: 'Português', flag: '/img/pt-997fb3879120a45e1ba507a9e060a662.png' },
      'sw': { text: 'Kiswahili', flag: '/img/sw-cdf6e2b06778f5ac662fb25f3ca8eac0.png' },
      'uk': { text: 'Українська', flag: '/img/ua-f7a81ef67d0931a29f7e358bb99ef521.png' }
    };

    const currentPath = window.location.pathname;
    let currentLang = 'en';

    // Determinare la lingua corrente dal percorso
    for (const lang in languageMap) {
      if (currentPath.includes('/' + lang)) {
        currentLang = lang;
        break;
      }
    }

    // Aggiorna la bandiera e il testo dinamicamente
    if (languageLabel && languageMap[currentLang]) {
      languageLabel.src = languageMap[currentLang].flag;
    }
  }); // Ritardo per garantire che la pagina sia completamente caricata
};
</script><script>window.__ow = window.__ow || {};
window.__ow.organizationId = "8b099b27-4836-4896-9087-a7ed505dec79";
window.__ow.template_id = "b97be07a-7dcf-48af-8d69-a9dfae5dfc29";
window.__ow.integration_name = "manual_settings";
window.__ow.product_name = "chatbot";   
;(function(n,t,c){function i(n){return e._h?e._h.apply(null,n):e._q.push(n)}var e={_q:[],_h:null,_v:"2.0",on:function(){i(["on",c.call(arguments)])},once:function(){i(["once",c.call(arguments)])},off:function(){i(["off",c.call(arguments)])},get:function(){if(!e._h)throw new Error("[OpenWidget] You can't use getters before load.");return i(["get",c.call(arguments)])},call:function(){i(["call",c.call(arguments)])},init:function(){var n=t.createElement("script");n.async=!0,n.type="text/javascript",n.src="https://cdn.openwidget.com/openwidget.js",t.head.appendChild(n)}};!n.__ow.asyncInit&&e.init(),n.OpenWidget=n.OpenWidget||e}(window,document,[].slice))</script><noscript>You need to <a href="https://www.chatbot.com/help/chat-widget/enable-javascript-in-your-browser/" rel="noopener nofollow">enable JavaScript</a> in order to use the AI chatbot tool powered by <a href="https://www.chatbot.com/" rel="noopener nofollow" target="_blank">ChatBot</a></noscript><script>(function() {
  // Funzioni di utilità per gestire i cookie
  function setCookie(name, value, days) {
    var expires = "";
    if (days) {
      var date = new Date();
      date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
      expires = "; expires=" + date.toUTCString();
    }
    document.cookie = name + "=" + (value || "") + expires + "; path=/";
  }

  function getCookie(name) {
    var nameEQ = name + "=";
    var ca = document.cookie.split(';');
    for (var i = 0; i < ca.length; i++) {
      var c = ca[i];
      while (c.charAt(0) === ' ') c = c.substring(1, c.length);
      if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
    }
    return null;
  }

  // Controlla se il consenso è già stato dato per nascondere il banner
  function checkConsent() {
    if (getCookie('consent_necessary') === "true") {
      document.getElementById('cookie-banner').style.display = 'none';
    } else {
      document.getElementById('cookie-banner').style.display = 'flex';
    }
  }

  // Funzione per accettare tutti i cookie
  window.acceptCookies = function() {
    setCookie('consent_necessary', 'true', 365);
    setCookie('consent_analytics', 'true', 365);
    setCookie('consent_marketing', 'true', 365);
    document.getElementById('cookie-banner').style.display = 'none';
    document.getElementById('cookie-popup').style.display = 'none';
    window.dataLayer = window.dataLayer || [];
    window.dataLayer.push({event: 'cookie_consent', consent_analytics: true, consent_marketing: true});
  };

  // Funzione per rifiutare cookie opzionali (analytics e marketing)
  window.rejectCookies = function() {
    setCookie('consent_necessary', 'true', 365);
    setCookie('consent_analytics', 'false', 365);
    setCookie('consent_marketing', 'false', 365);
    document.getElementById('cookie-banner').style.display = 'none';
    document.getElementById('cookie-popup').style.display = 'none';
    window.dataLayer = window.dataLayer || [];
    window.dataLayer.push({event: 'cookie_consent', consent_analytics: false, consent_marketing: false});
  };

  // Mostra il popup per gestire le preferenze dei cookie
  window.showCookiePopup = function(event) {
    event.preventDefault();
    document.getElementById('cookie-popup').style.display = 'flex';
  };
  window.closeCookiePopup = function() {
  document.getElementById('cookie-popup').style.display = 'none';
  };

  // Salva le preferenze impostate nel popup
  window.savePreferences = function() {
    var analyticsConsent = document.getElementById('analytics-cookies').checked;
    var marketingConsent = document.getElementById('marketing-cookies').checked;
    setCookie('consent_necessary', 'true', 365);
    setCookie('consent_analytics', analyticsConsent ? 'true' : 'false', 365);
    setCookie('consent_marketing', marketingConsent ? 'true' : 'false', 365);
    document.getElementById('cookie-banner').style.display = 'none';
    document.getElementById('cookie-popup').style.display = 'none';
    window.dataLayer = window.dataLayer || [];
    window.dataLayer.push({event: 'cookie_consent', consent_analytics: analyticsConsent, consent_marketing: marketingConsent});
  };

  // Inizializza il controllo del consenso al caricamento della pagina
  checkConsent();
})();</script></body></html>
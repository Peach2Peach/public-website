<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta http-equiv="X-UA-Compatible" content="ie=edge"/><meta http-equiv="X-Frame-Options" content="DENY"/><meta http-equiv="X-XSS-Protection" content="1; mode=block"/><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/><meta name="keywords" content="[&quot;Bitcoin&quot;,&quot;buy bitcoin&quot;,&quot;sell bitcoin&quot;,&quot;Peach app&quot;,&quot;P2P&quot;,&quot;p2p&quot;,&quot;p2p exchange&quot;,&quot;how to buy bitcoin&quot;,&quot;how to sell bitcoin&quot;,&quot;peer to peer&quot;]"/><meta name="description" content="Bitcoin is money for free people. We believe that every single human being has the right to choose which money he uses to store his 
wealth, the result of his work, his time and energy.
Peach’s mission is to do its part to contribute to Bitcoin’s adoption in the hands of the people.
"/><meta property="og:locale" content="en"/><meta property="og:site_name"/><meta property="og:title" content="Peach Bitcoin Exchange - Buy and Sell Bitcoin Anonymously and Without KYC"/><meta property="og:description" content="Peach Bitcoin - Buy Bitcoin with gift card, no verification. Exchange peer to peer for anonymous transactions. Learn how to buy and sell Bitcoin privately and without KYC. Manage your Bitcoin securely with our non-KYC platform."/><meta property="og:type" content="website"/><meta property="og:image" content="/img/blog/lightning.jpeg"/><meta property="og:image:secure_url" content="/img/blog/lightning.jpeg"/><meta property="og:image:width" content="1296"/><meta property="og:image:height" content="678"/><meta name="twitter:site" content="@peachbitcoin"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="LN &lt;-&gt; On-Chain Swaps, by @swissnode · Peach Bitcoin"/><meta name="twitter:description" content="Peach Bitcoin - Buy Bitcoin with gift card, no verification. Exchange peer to peer for anonymous transactions. Learn how to buy and sell Bitcoin privately and  without KYC. Manage your Bitcoin securely with our non-KYC platform."/><meta name="twitter:image" content="/img/blog/lightning.jpeg"/><meta name="msapplication-TileColor" content="#F56522"/><meta name="theme-color" content="#F56522"/><link rel="preload" as="font" crossorigin="crossorigin" href="/fonts/baloo-2-v16-latin-regular.woff2"/><link rel="preload" as="font" crossorigin="crossorigin" href="/fonts/baloo-2-v16-latin-600.woff2"/><link rel="preload" as="font" crossorigin="crossorigin" href="/fonts/baloo-2-v16-latin-800.woff2"/><link rel="apple-touch-icon" href="/img/favicon/apple-touch-icon.png"/><link rel="icon" href="/img/favicon/favicon.svg"/><link rel="manifest" href="/site.webmanifest"/><link rel="mask-icon" href="/img/favicon/safari-pinned-tab.svg" color="#F56522"/><link rel="stylesheet" href="/css/main-b3f858619e229dd5f6c79ee84b2440d2.css"/><title>LN &lt;-&gt; On-Chain Swaps, by @swissnode · Peach Bitcoin</title><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KQHJRQKH');</script></head><body id="blog-why-peach-and-submarine-swaps-are-a-match-made-in-heaven"><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KQHJRQKH" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><header class="header header-container" id="header"><div class="wrap"><a class="logo-link brand" href="/"><img class="logo logo" src="/img/peach-bitcoin-145cd6c0079ccacc9c70c892060964d1.svg" alt="Peach Bitcoin"/></a><input id="show-menu" type="checkbox"/><label class="nav-toggle-label" id="nav-toggle" for="show-menu"><svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path class="line--1" d="M0 70l28-28c2-2 2-2 7-2h64"></path><path class="line--2" d="M0 50h99"></path><path class="line--3" d="M0 30l28 28c2 2 2 2 7 2h64"></path></svg></label><nav class="nav"><a href="/how-it-works/">Buy BTC without KYC</a><a href="/for-meetups/">Buy BTC with cash</a><a href="/for-businesses/">Sell BTC</a><a href="/blog/">Blog</a><a href="/support/">Support</a><div class="language-selector"><input class="checkbox" type="checkbox" id="language-toggle"/><label class="language-label" for="language-toggle"><span class="language-text">English</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="white" style="margin-left: .25rem;"><path d="M7 10l5 5 5-5z"></path></svg></label><ul class="language-dropdown"><li><a href="/"> <span>English</span></a></li><li><a href="/es"> <span>Español</span></a></li><li><a href="/de"> <span>Deutsch</span></a></li><li><a href="/it"> <span>Italiano</span></a></li><li><a href="/fr"> <span>Français</span></a></li><li><a href="/pt"> <span>Português</span></a></li></ul></div></nav></div></header><main class="main" id="main"><div id="header-anchor"></div><section class="wrap"><div class="content-wrap post"><h1 id="ln-on-chain-swaps-by-swissnode">LN <-> On-Chain Swaps, by @swissnode</h1>
<h2 id="why-peach-and-submarine-swaps-are-a-match-made-in-heaven">Why Peach and Submarine swaps are a match made in heaven</h2>
<p>I have been quite vocal in my support for Peach and have even put a few sats where my mouth is after being convinced nearly two years ago about the brilliance of what Peach has to offer the Bitcoin community: a simple way for the simple stacker to stack his or her sats without the need to identify themself to a platform in order to do so.</p>
<p>It came to my notice as a runner of the SwissNode lightning node that the currency pairing need not be limited to a fiat-Bitcoin swap. There are indeed use cases for going beyond that. Welcome to the world of onchain-offchain submarine swaps.</p>
<p>A submarine swap is, simply put, a way of converting sats that partner A has onchain with sats that partner B may have on the Lightning Network (LN). A thus gains sats via a LN invoice and B gains onchain sats via a usual transaction on the Blockchain.</p>
<p>There are two main reasons for wanting to do this. A node runner might simply want more of his liquidity on the lightning side, perhaps to balance the proportion of sats that are held in "local" channel capacity and those held in "remote" channel capacity. I will leave it there, this is obviously a more technical aspect of the submarine swap. A node runner can conversely also want to convert some of his liquidity from the lightning network back into "onchain" utxos. This has happened to me when a counterparty wanted payment only via the blockchain instead of via lightning, for example.</p>
<p>The second reason for wanting such a swap is, however, something that nearly all Bitcoiners can or SHOULD relish: the ability to break the traceability of the utxo set he or she posseses so that no entity has the ability to know what happened to the sats previously held onchain. This cannot be overstated! Once the sats in your utxo have passed on, you then hold your liquidity in various channels which are practically impossible to peer inside. The nature of lightning is such that the tried-and-tested double-entry accounting of the channels used mean only your channel partners are able to know how many sats you own on the other side of the channel. In theory you could submarine swap those lightning sats back again and then be in possession of a utxo that cannot at all be traced to its owner!</p>
<p>Why should Peach want to do this? … I hear you ask… Well here is the kicker. By offering this service for next to nothing, Peach suddenly becomes EXTREMELY attractive to the thousands of node owners out there needing to swap in and out of onchain/offchain liquidity pools. Currently services exist like the LOOP servicec from Lightning Labs but you will pay quite a lot for the privilege. In this way Peach is sure to gain hundreds if not thousands of new users who need this service. Even by offering it for free, they would onboard many who came for the swaps but then discovered the best way to stack p2 without kyc.</p>
<p>How does this work in practice? Very simply it hardly differs from the usual Peach use case: The seller will create an onchain escrow with Peach for a certain number of sats. The only departure from the normal path is that he must now decide: will he demand the lightning sats via LNURL. It allows the seller to determine a margin ( -21% < x < 21% ). It might be an idea in future releases to also make normal LN invoices a margin-less sale. Once this has been done the usual process kicks in… Once the escrow is set up and confirmed a buyer can indicate his willingness to buy those onchain sats with a "match". If the seller "double matches" the buyer must send the off-chain sats via LNURL. Once confirmed by the seller, the escrow will release the onchain sats to the buyer. Usual processes still apply should the buyer or seller dispute the action of the other. Peach will determine what is what and release the escrow as per the normal tried and tested dispute process.</p>
<p>@swissnode</p>
<h2 id="final-notes">Final Notes</h2>
<p>If you want to know more about Peach features, or read some of our other articles, you can find them here!</p>
<p><a href="https://peachbitcoin.com/blog/how-to-restore-peach-wallet/">How to Recover Bitcoin Wallets Using a Seed Phrase</a></p>
<p><a href="https://peachbitcoin.com/blog/funding-multiple-sell-offers/">How to Fund Multiple Sell Offers</a></p>
<p><a href="https://peachbitcoin.com/blog/how-to-buy-and-sell-bitcoin-with-cash-using-peach/">How to buy and sell Bitcoin with cash using Peach</a></p>
<p><a href="https://peachbitcoin.com/blog/how-to-add-a-payment-method/">How to add a new payment method on the Peach app</a></p>
<p><a href="https://peachbitcoin.com/blog/peach-expands-to-the-global-south/">Peach expands to the Global South!</a></p>
<p><a href="https://peachbitcoin.com/blog/making-our-peach-api-public/">Making our Peach-API Public</a></p>
<p><a href="https://peachbitcoin.com/blog/full-wallet-functionality/">Full Wallet Functionality</a></p>
<p><a href="https://peachbitcoin.com/blog/group-hug/">What is GroupHug?</a></p>
<p><a href="https://peachbitcoin.com/blog/why-p2p-chapter-1/">Why P2P series? Chapter 1</a></p>
<p><a href="https://peachbitcoin.com/blog/why-p2p-chapter-2/">Why P2P series? Chapter 2</a></p>
<p><a href="https://peachbitcoin.com/blog/why-p2p-chapter-3-circular-economies/">Why P2P series? Chapter 3</a></p>
<p><a href="https://peachbitcoin.com/blog/why-p2p-chapter-4-chains-of-trust/">Why P2P series? Chapter 4</a></p>
<p><a href="https://peachbitcoin.com/blog/peach-for-meetups/">Peach x meetups</a></p>
<p>If you want to know more about us, check out or socials, or simply <a href="mailto:hello@peachbitcoin.com">contact us</a> (use our <a href="https://keys.openpgp.org/vks/v1/by-fingerprint/48339A19645E2E53488E0E5479E1B270FACD1BD2">PGP key</a> if possible) we'll be happy to hear from you!</p>
<p><a href="https://t.me/peachtopeach">Telegram</a>, <a href="https://discord.gg/ypeHz3SW54">Discord</a>, <a href="https://twitter.com/peachbitcoin">Twitter</a>, <a href="https://instagram.com/peachbitcoin">Instagram</a></p>
<p>Keep spreading the Peach word, who knows when you'll find the match of your life!</p>
<p class="date">August 9th, 2023</p><p class="tags">Tagged with:<a href="/blog/tag/product">Product</a></p><p><a href="/blog/">All blog posts</a></p></div></section></main><footer class="footer" id="footer"><div class="wrap"><div class="logo-section"><div class="logo"><img class="logo-image" src="/img/peach-footer-logo-e28fd7e07f654f43afd63c9b6ace3cdb.svg" alt="Peach logo"/><span>Made in Switzerland <img src="/img/flags/switzerland-icon.svg" style="width: 1rem; margin-left .5rem;"/></span></div><div class="company-info"> <img class="polyreg-image" src="/img/polyreg-52ec37fb80d0312b219110c05567ad3d.png" alt="Polyreg logo" width="120"/><p>Peach is an SRO member (Self Regulatory Organisation) of Polyreg </p><p>Peach is a Swiss licensed financial service provider and is fully compliant with Switzerland’s Anti-Money Laundering Act. </p></div></div><div class="content"><div class="footer-box"><h6>Company</h6><a href="/join-us/">Join Us</a><a href="/terms-and-conditions/">Terms and Conditions</a><a href="/privacy-policy/">Privacy Policy</a><a class="cookie-link" href="#" onclick="showCookiePopup(event)">Manage Cookie Preferences</a></div><div class="footer-box"><h6>Contact</h6><a href="mailto:hello@peachbitcoin.com">Email</a><a href="https://keys.openpgp.org/vks/v1/by-fingerprint/48339A19645E2E53488E0E5479E1B270FACD1BD2">PGP Key</a></div><div class="footer-box"><h6>Download</h6><span>0.69.0 (294)</span><a href="/apk/">APK</a><a href="https://testflight.apple.com/join/wfSPFEWG">iPhone</a><a href="https://play.google.com/store/apps/details?id=com.peachbitcoin.peach.mainnet">Android</a></div><div class="footer-box"><h6>Community</h6><a href="https://twitter.com/peachbitcoin" target="_blank" rel="noreferrer noopener">Twitter</a><a href="https://t.me/peachtopeach" target="_blank" rel="noreferrer noopener">Telegram</a><a href="https://discord.gg/ypeHz3SW54" target="_blank" rel="noreferrer noopener">Discord</a><a href="https://www.instagram.com/peachbitcoin/" target="_blank" rel="noreferrer noopener">Instagram</a><a href="https://snort.social/p/npub15369wu3wzzar5fclhecyqfv683x69n6nhlg7rxqnsg2dydgxflpq3apswl" target="_blank" rel="noreferrer noopener">Nostr</a><a href="https://github.com/Peach2Peach" target="_blank" rel="noreferrer noopener">Github</a><a href="https://www.youtube.com/@peachbitcoin" target="_blank" rel="noreferrer noopener">YouTube</a></div><div class="footer-box"><h6>Bitcoin</h6><a href="/bitcoin.pdf">Whitepaper</a><a href="https://docs.peachbitcoin.com">API Documentation</a></div><div class="footer-box"><h6>Earn Bitcoin</h6><a href="/new-users/">Referral Code</a><a href="/for-businesses/">Become an Affiliate</a></div></div></div></footer><style>#cookie-banner {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background-color: #120A07;
  color: #fff;
  padding: 15px 0;
  z-index: 9999;
  font-size: 14px;
}
#cookie-banner .cookie-container {
  width: 90%;
  max-width: 1200px;
  margin: 0 auto;
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  align-items: center;
}
#cookie-banner p {
  margin: 0;
  line-height: 1.4;
}
#cookie-banner .cookie-actions {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-top: 10px;
}
#cookie-banner button {
  padding: 10px 16px;
  color: #fff;
  background-color: #65A519;
  border: none;
  cursor: pointer;
  border-radius: 4px;
  font-size: 14px;
  transition: background-color 0.3s ease;
}
#cookie-banner button:hover {
  background-color: #65A519;
}
#cookie-banner button.reject {
  background-color: #DF321F;
}
#cookie-banner button.reject:hover {
  background-color: #DF321F;
}
#cookie-banner a.cookie-link {
  color: #fff;
  text-decoration: underline;
  font-size: 14px;
  margin-left: 8px;
  cursor: pointer;
}
#cookie-banner a.cookie-link:hover {
  text-decoration: none;
}
/* Popup overlay */
#cookie-popup {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.8);
  z-index: 10000;
  justify-content: center;
  align-items: center;
  color: #fff;
}
/* Contenitore del popup */
#cookie-popup-content {
  position: relative;
  background-color: #120A07;
  color:rgb(255, 255, 255);
  padding: 30px 20px 20px;
  border-radius: 10px;
  width: 80%;
  max-width: 600px;
  box-sizing: border-box;
}
/* Pulsante di chiusura */
#cookie-popup-content .close-btn {
  position: absolute;
  top: 10px;
  right: 10px;
  background: none;
  border: none;
  color: #fff;
  font-size: 24px;
  line-height: 1;
  cursor: pointer;
  padding: 0 5px;
}
#cookie-popup-content .close-btn:hover {
  color: #ccc;
}
/* Stile per ciascuna categoria di cookie */
.cookie-category {
  margin-bottom: 20px;
}
/* Migliora i checkbox e le label */
.cookie-category label {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  cursor: pointer;
  font-size: 15px;
}
.cookie-category input[type="checkbox"] {
  accent-color: #4CAF50;
  margin: 0;
  cursor: pointer;
}
.cookie-category p {
  margin: 4px 0 0 28px;
  font-size: 14px;
  line-height: 1.4;
  color: #ccc;
}
/* Bottone "Salva Preferenze" */
#cookie-popup-content button.save-btn {
  background-color: #4CAF50;
  border: none;
  padding: 10px 16px;
  color: #fff;
  font-size: 14px;
  cursor: pointer;
  border-radius: 4px;
  transition: background-color 0.3s ease;
}
#cookie-popup-content button.save-btn:hover {
  background-color: #43a047;
}
/* Media query per schermi più piccoli */
@media (max-width: 768px) {
  #cookie-banner .cookie-container {
    flex-direction: column;
    align-items: flex-start;
  }
  #cookie-banner .cookie-actions {
    margin-top: 10px;
    width: 100%;
    justify-content: flex-start;
    gap: 8px;
    flex-wrap: wrap;
  }
}

</style><div id="cookie-banner" style="display: none;"><div class="cookie-container"><p>We use cookies to improve your experience. <a href="/privacy-policy" style="color: #4CAF50;">Read more</a></p><div class="cookie-actions"><button class="cookie-btn" onclick="acceptCookies()">Accept Cookies &amp; Continue</button><button class="cookie-btn reject" onclick="rejectCookies()">Reject Cookies</button><a class="cookie-link" href="#" onclick="showCookiePopup(event)">Manage Cookies</a></div></div></div><div id="cookie-popup"><div id="cookie-popup-content"><button class="close-btn" type="button" onclick="closeCookiePopup()">×</button><h2>Manage cookie preferences</h2><div class="cookie-category"><div class="switch-container"><span class="label-text">Necessary Cookies</span><label class="switch" for="necessary-cookies"><input type="checkbox" id="necessary-cookies" checked="checked" disabled="disabled"/><span class="slider"></span></label></div><p>These cookies are essential for the website's operation.</p></div><div class="cookie-category"><div class="switch-container"><span class="label-text">Analytics Cookies</span><label class="switch" for="analytics-cookies"><input type="checkbox" id="analytics-cookies"/><span class="slider"></span></label></div><p>Analytics cookies help us understand how users interact with the site.</p></div><div class="cookie-category"><div class="switch-container"><span class="label-text">Marketing Cookies</span><label class="switch" for="marketing-cookies"><input type="checkbox" id="marketing-cookies"/><span class="slider"></span></label></div><p>Marketing cookies are used to collect users information</p></div><div style="text-align: right; margin-top: 20px;"><button class="save-btn" type="button" onclick="savePreferences()">Save Preferences</button></div></div></div><script src="/js/main-15c0432b5e5f06cbab9e3fedcaae3032.js"></script><script>if ('serviceWorker' in navigator) {
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('/service-worker.js')
      .then(function(registration) {
        console.log('Service Worker registrato con successo:', registration);
      })
      .catch(function(error) {
        console.log('Registrazione del Service Worker fallita:', error);
      });
  });
} else {
  console.log('Service Worker non supportato in questo browser.');
}
</script><script>document.addEventListener('DOMContentLoaded', function () {
  // Map of language codes to display names
  const languageMap = {
    en: 'English',
    es: 'Español',
    de: 'Deutsch',
    it: 'Italiano',
    fr: 'Français',
    el: 'Ελληνικά',
    hu: 'Magyar',
    nl: 'Nederlands',
    pl: 'Polski',
    pt: 'Português',
    sw: 'Kiswahili',
    uk: 'Українська'
  };

  // Detect current lang from path
  const path = window.location.pathname.replace(/\/+$/, ''); // trim trailing slash
  let currentLang = 'en';
  for (const code in languageMap) {
    if (path === '/' && code === 'en') { currentLang = 'en'; break; }
    if (path === `/${code}` || path.startsWith(`/${code}/`)) { currentLang = code; break; }
  }

  const label = document.querySelector('.language-label');
  if (!label) return;

  // Ensure there is a span.language-text, create it if missing
  let textNode = label.querySelector('.language-text');
  if (!textNode) {
    textNode = document.createElement('span');
    textNode.className = 'language-text';
    // insert before the dropdown chevron if present
    // const chevron = Array.from(label.querySelectorAll('img')).find(img => /dropdown_icon\.svg(\?.*)?$/i.test(img.getAttribute('src') || ''));
    label.insertBefore(textNode, chevron || null);
  }

  // Set the text
  textNode.textContent = languageMap[currentLang] || currentLang.toUpperCase();

  // Remove any flag images inside the label (keep the chevron)
  //- Array.from(label.querySelectorAll('img')).forEach(img => {
  //-   const src = img.getAttribute('src') || '';
  //-   const isChevron = /dropdown_icon\.svg(\?.*)?$/i.test(src);
  //-   if (!isChevron) {
  //-     img.remove();
  //-   }
  //- });

  // Also nuke any pseudo-element flags applied via CSS (belt & suspenders)
  label.style.backgroundImage = 'none';
});

</script><script>window.__ow = window.__ow || {};
window.__ow.organizationId = "8b099b27-4836-4896-9087-a7ed505dec79";
window.__ow.template_id = "b97be07a-7dcf-48af-8d69-a9dfae5dfc29";
window.__ow.integration_name = "manual_settings";
window.__ow.product_name = "chatbot";   
;(function(n,t,c){function i(n){return e._h?e._h.apply(null,n):e._q.push(n)}var e={_q:[],_h:null,_v:"2.0",on:function(){i(["on",c.call(arguments)])},once:function(){i(["once",c.call(arguments)])},off:function(){i(["off",c.call(arguments)])},get:function(){if(!e._h)throw new Error("[OpenWidget] You can't use getters before load.");return i(["get",c.call(arguments)])},call:function(){i(["call",c.call(arguments)])},init:function(){var n=t.createElement("script");n.async=!0,n.type="text/javascript",n.src="https://cdn.openwidget.com/openwidget.js",t.head.appendChild(n)}};!n.__ow.asyncInit&&e.init(),n.OpenWidget=n.OpenWidget||e}(window,document,[].slice))</script><noscript>You need to <a href="https://www.chatbot.com/help/chat-widget/enable-javascript-in-your-browser/" rel="noopener nofollow">enable JavaScript</a> in order to use the AI chatbot tool powered by <a href="https://www.chatbot.com/" rel="noopener nofollow" target="_blank">ChatBot</a></noscript><script>(function() {
  // Funzioni di utilità per gestire i cookie
  function setCookie(name, value, days) {
    var expires = "";
    if (days) {
      var date = new Date();
      date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
      expires = "; expires=" + date.toUTCString();
    }
    document.cookie = name + "=" + (value || "") + expires + "; path=/";
  }

  function getCookie(name) {
    var nameEQ = name + "=";
    var ca = document.cookie.split(';');
    for (var i = 0; i < ca.length; i++) {
      var c = ca[i];
      while (c.charAt(0) === ' ') c = c.substring(1, c.length);
      if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
    }
    return null;
  }

  // Controlla se il consenso è già stato dato per nascondere il banner
  function checkConsent() {
    if (getCookie('consent_necessary') === "true") {
      document.getElementById('cookie-banner').style.display = 'none';
    } else {
      document.getElementById('cookie-banner').style.display = 'flex';
    }
  }

  // Funzione per accettare tutti i cookie
  window.acceptCookies = function() {
    setCookie('consent_necessary', 'true', 365);
    setCookie('consent_analytics', 'true', 365);
    setCookie('consent_marketing', 'true', 365);
    document.getElementById('cookie-banner').style.display = 'none';
    document.getElementById('cookie-popup').style.display = 'none';
    window.dataLayer = window.dataLayer || [];
    window.dataLayer.push({event: 'cookie_consent', consent_analytics: true, consent_marketing: true});
  };

  // Funzione per rifiutare cookie opzionali (analytics e marketing)
  window.rejectCookies = function() {
    setCookie('consent_necessary', 'true', 365);
    setCookie('consent_analytics', 'false', 365);
    setCookie('consent_marketing', 'false', 365);
    document.getElementById('cookie-banner').style.display = 'none';
    document.getElementById('cookie-popup').style.display = 'none';
    window.dataLayer = window.dataLayer || [];
    window.dataLayer.push({event: 'cookie_consent', consent_analytics: false, consent_marketing: false});
  };

  // Mostra il popup per gestire le preferenze dei cookie
  window.showCookiePopup = function(event) {
    event.preventDefault();
    document.getElementById('cookie-popup').style.display = 'flex';
  };
  window.closeCookiePopup = function() {
  document.getElementById('cookie-popup').style.display = 'none';
  };

  // Salva le preferenze impostate nel popup
  window.savePreferences = function() {
    var analyticsConsent = document.getElementById('analytics-cookies').checked;
    var marketingConsent = document.getElementById('marketing-cookies').checked;
    setCookie('consent_necessary', 'true', 365);
    setCookie('consent_analytics', analyticsConsent ? 'true' : 'false', 365);
    setCookie('consent_marketing', marketingConsent ? 'true' : 'false', 365);
    document.getElementById('cookie-banner').style.display = 'none';
    document.getElementById('cookie-popup').style.display = 'none';
    window.dataLayer = window.dataLayer || [];
    window.dataLayer.push({event: 'cookie_consent', consent_analytics: analyticsConsent, consent_marketing: marketingConsent});
  };

  // Inizializza il controllo del consenso al caricamento della pagina
  checkConsent();
})();</script></body></html>